{"ast":null,"code":"/**\r\n * DevExtreme (data/array_query.js)\r\n * Version: 20.2.3\r\n * Build date: Tue Oct 20 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _class = _interopRequireDefault(require(\"../core/class\"));\n\nvar _type = require(\"../core/utils/type\");\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _data = require(\"../core/utils/data\");\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nvar _errors = _interopRequireDefault(require(\"./errors\"));\n\nvar _utils = _interopRequireDefault(require(\"./utils\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar Iterator = _class.default.inherit({\n  toArray: function toArray() {\n    var result = [];\n    this.reset();\n\n    while (this.next()) {\n      result.push(this.current());\n    }\n\n    return result;\n  },\n  countable: function countable() {\n    return false;\n  }\n});\n\nvar ArrayIterator = Iterator.inherit({\n  ctor: function ctor(array) {\n    this.array = array;\n    this.index = -1;\n  },\n  next: function next() {\n    if (this.index + 1 < this.array.length) {\n      this.index++;\n      return true;\n    }\n\n    return false;\n  },\n  current: function current() {\n    return this.array[this.index];\n  },\n  reset: function reset() {\n    this.index = -1;\n  },\n  toArray: function toArray() {\n    return this.array.slice(0);\n  },\n  countable: function countable() {\n    return true;\n  },\n  count: function count() {\n    return this.array.length;\n  }\n});\nvar WrappedIterator = Iterator.inherit({\n  ctor: function ctor(iter) {\n    this.iter = iter;\n  },\n  next: function next() {\n    return this.iter.next();\n  },\n  current: function current() {\n    return this.iter.current();\n  },\n  reset: function reset() {\n    return this.iter.reset();\n  }\n});\nvar MapIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, mapper) {\n    this.callBase(iter);\n    this.index = -1;\n    this.mapper = mapper;\n  },\n  current: function current() {\n    return this.mapper(this.callBase(), this.index);\n  },\n  next: function next() {\n    var hasNext = this.callBase();\n\n    if (hasNext) {\n      this.index++;\n    }\n\n    return hasNext;\n  }\n});\n\nvar defaultCompare = function defaultCompare(xValue, yValue) {\n  xValue = (0, _data.toComparable)(xValue);\n  yValue = (0, _data.toComparable)(yValue);\n\n  if (null === xValue && null !== yValue) {\n    return -1;\n  }\n\n  if (null !== xValue && null === yValue) {\n    return 1;\n  }\n\n  if (void 0 === xValue && void 0 !== yValue) {\n    return 1;\n  }\n\n  if (void 0 !== xValue && void 0 === yValue) {\n    return -1;\n  }\n\n  if (xValue < yValue) {\n    return -1;\n  }\n\n  if (xValue > yValue) {\n    return 1;\n  }\n\n  return 0;\n};\n\nvar SortIterator = Iterator.inherit({\n  ctor: function ctor(iter, getter, desc, compare) {\n    if (!(iter instanceof MapIterator)) {\n      iter = new MapIterator(iter, this._wrap);\n    }\n\n    this.iter = iter;\n    this.rules = [{\n      getter: getter,\n      desc: desc,\n      compare: compare\n    }];\n  },\n  thenBy: function thenBy(getter, desc, compare) {\n    var result = new SortIterator(this.sortedIter || this.iter, getter, desc, compare);\n\n    if (!this.sortedIter) {\n      result.rules = this.rules.concat(result.rules);\n    }\n\n    return result;\n  },\n  next: function next() {\n    this._ensureSorted();\n\n    return this.sortedIter.next();\n  },\n  current: function current() {\n    this._ensureSorted();\n\n    return this.sortedIter.current();\n  },\n  reset: function reset() {\n    delete this.sortedIter;\n  },\n  countable: function countable() {\n    return this.sortedIter || this.iter.countable();\n  },\n  count: function count() {\n    if (this.sortedIter) {\n      return this.sortedIter.count();\n    }\n\n    return this.iter.count();\n  },\n  _ensureSorted: function _ensureSorted() {\n    var that = this;\n\n    if (that.sortedIter) {\n      return;\n    }\n\n    (0, _iterator.each)(that.rules, function () {\n      this.getter = (0, _data.compileGetter)(this.getter);\n    });\n    that.sortedIter = new MapIterator(new ArrayIterator(this.iter.toArray().sort(function (x, y) {\n      return that._compare(x, y);\n    })), that._unwrap);\n  },\n  _wrap: function _wrap(record, index) {\n    return {\n      index: index,\n      value: record\n    };\n  },\n  _unwrap: function _unwrap(wrappedItem) {\n    return wrappedItem.value;\n  },\n  _compare: function _compare(x, y) {\n    var xIndex = x.index;\n    var yIndex = y.index;\n    x = x.value;\n    y = y.value;\n\n    if (x === y) {\n      return xIndex - yIndex;\n    }\n\n    for (var i = 0, rulesCount = this.rules.length; i < rulesCount; i++) {\n      var rule = this.rules[i];\n      var xValue = rule.getter(x);\n      var yValue = rule.getter(y);\n      var compare = rule.compare || defaultCompare;\n      var compareResult = compare(xValue, yValue);\n\n      if (compareResult) {\n        return rule.desc ? -compareResult : compareResult;\n      }\n    }\n\n    return xIndex - yIndex;\n  }\n});\n\nvar compileCriteria = function () {\n  var compileGroup = function compileGroup(crit) {\n    var ops = [];\n    var isConjunctiveOperator = false;\n    var isConjunctiveNextOperator = false;\n    (0, _iterator.each)(crit, function () {\n      if (Array.isArray(this) || (0, _type.isFunction)(this)) {\n        if (ops.length > 1 && isConjunctiveOperator !== isConjunctiveNextOperator) {\n          throw new _errors.default.errors.Error(\"E4019\");\n        }\n\n        ops.push(compileCriteria(this));\n        isConjunctiveOperator = isConjunctiveNextOperator;\n        isConjunctiveNextOperator = true;\n      } else {\n        isConjunctiveNextOperator = _utils.default.isConjunctiveOperator(this);\n      }\n    });\n    return function (d) {\n      var result = isConjunctiveOperator;\n\n      for (var i = 0; i < ops.length; i++) {\n        if (ops[i](d) !== isConjunctiveOperator) {\n          result = !isConjunctiveOperator;\n          break;\n        }\n      }\n\n      return result;\n    };\n  };\n\n  var toString = function toString(value) {\n    return (0, _type.isDefined)(value) ? value.toString() : \"\";\n  };\n\n  var compileBinary = function compileBinary(crit) {\n    crit = _utils.default.normalizeBinaryCriterion(crit);\n    var getter = (0, _data.compileGetter)(crit[0]);\n    var op = crit[1];\n    var value = crit[2];\n    value = (0, _data.toComparable)(value);\n\n    switch (op.toLowerCase()) {\n      case \"=\":\n        return compileEquals(getter, value);\n\n      case \"<>\":\n        return compileEquals(getter, value, true);\n\n      case \">\":\n        return function (obj) {\n          return (0, _data.toComparable)(getter(obj)) > value;\n        };\n\n      case \"<\":\n        return function (obj) {\n          return (0, _data.toComparable)(getter(obj)) < value;\n        };\n\n      case \">=\":\n        return function (obj) {\n          return (0, _data.toComparable)(getter(obj)) >= value;\n        };\n\n      case \"<=\":\n        return function (obj) {\n          return (0, _data.toComparable)(getter(obj)) <= value;\n        };\n\n      case \"startswith\":\n        return function (obj) {\n          return 0 === (0, _data.toComparable)(toString(getter(obj))).indexOf(value);\n        };\n\n      case \"endswith\":\n        return function (obj) {\n          var getterValue = (0, _data.toComparable)(toString(getter(obj)));\n          var searchValue = toString(value);\n\n          if (getterValue.length < searchValue.length) {\n            return false;\n          }\n\n          return getterValue.lastIndexOf(value) === getterValue.length - value.length;\n        };\n\n      case \"contains\":\n        return function (obj) {\n          return (0, _data.toComparable)(toString(getter(obj))).indexOf(value) > -1;\n        };\n\n      case \"notcontains\":\n        return function (obj) {\n          return (0, _data.toComparable)(toString(getter(obj))).indexOf(value) === -1;\n        };\n    }\n\n    throw _errors.default.errors.Error(\"E4003\", op);\n  };\n\n  function compileEquals(getter, value, negate) {\n    return function (obj) {\n      obj = (0, _data.toComparable)(getter(obj));\n      var result = useStrictComparison(value) ? obj === value : obj == value;\n\n      if (negate) {\n        result = !result;\n      }\n\n      return result;\n    };\n  }\n\n  function useStrictComparison(value) {\n    return \"\" === value || 0 === value || false === value;\n  }\n\n  function compileUnary(crit) {\n    var op = crit[0];\n    var criteria = compileCriteria(crit[1]);\n\n    if (\"!\" === op) {\n      return function (obj) {\n        return !criteria(obj);\n      };\n    }\n\n    throw _errors.default.errors.Error(\"E4003\", op);\n  }\n\n  return function (crit) {\n    if ((0, _type.isFunction)(crit)) {\n      return crit;\n    }\n\n    if (_utils.default.isGroupCriterion(crit)) {\n      return compileGroup(crit);\n    }\n\n    if (_utils.default.isUnaryOperation(crit)) {\n      return compileUnary(crit);\n    }\n\n    return compileBinary(crit);\n  };\n}();\n\nvar FilterIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, criteria) {\n    this.callBase(iter);\n    this.criteria = compileCriteria(criteria);\n  },\n  next: function next() {\n    while (this.iter.next()) {\n      if (this.criteria(this.current())) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n});\nvar GroupIterator = Iterator.inherit({\n  ctor: function ctor(iter, getter) {\n    this.iter = iter;\n    this.getter = getter;\n  },\n  next: function next() {\n    this._ensureGrouped();\n\n    return this.groupedIter.next();\n  },\n  current: function current() {\n    this._ensureGrouped();\n\n    return this.groupedIter.current();\n  },\n  reset: function reset() {\n    delete this.groupedIter;\n  },\n  countable: function countable() {\n    return !!this.groupedIter;\n  },\n  count: function count() {\n    return this.groupedIter.count();\n  },\n  _ensureGrouped: function _ensureGrouped() {\n    if (this.groupedIter) {\n      return;\n    }\n\n    var hash = {};\n    var keys = [];\n    var iter = this.iter;\n    var getter = (0, _data.compileGetter)(this.getter);\n    iter.reset();\n\n    while (iter.next()) {\n      var current = iter.current();\n      var key = getter(current);\n\n      if (key in hash) {\n        hash[key].push(current);\n      } else {\n        hash[key] = [current];\n        keys.push(key);\n      }\n    }\n\n    this.groupedIter = new ArrayIterator((0, _iterator.map)(keys, function (key) {\n      return {\n        key: key,\n        items: hash[key]\n      };\n    }));\n  }\n});\nvar SelectIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, getter) {\n    this.callBase(iter);\n    this.getter = (0, _data.compileGetter)(getter);\n  },\n  current: function current() {\n    return this.getter(this.callBase());\n  },\n  countable: function countable() {\n    return this.iter.countable();\n  },\n  count: function count() {\n    return this.iter.count();\n  }\n});\nvar SliceIterator = WrappedIterator.inherit({\n  ctor: function ctor(iter, skip, take) {\n    this.callBase(iter);\n    this.skip = Math.max(0, skip);\n    this.take = Math.max(0, take);\n    this.pos = 0;\n  },\n  next: function next() {\n    if (this.pos >= this.skip + this.take) {\n      return false;\n    }\n\n    while (this.pos < this.skip && this.iter.next()) {\n      this.pos++;\n    }\n\n    this.pos++;\n    return this.iter.next();\n  },\n  reset: function reset() {\n    this.callBase();\n    this.pos = 0;\n  },\n  countable: function countable() {\n    return this.iter.countable();\n  },\n  count: function count() {\n    return Math.min(this.iter.count() - this.skip, this.take);\n  }\n});\n\nvar arrayQueryImpl = function arrayQueryImpl(iter, queryOptions) {\n  queryOptions = queryOptions || {};\n\n  if (!(iter instanceof Iterator)) {\n    iter = new ArrayIterator(iter);\n  }\n\n  var handleError = function handleError(error) {\n    var handler = queryOptions.errorHandler;\n\n    if (handler) {\n      handler(error);\n    }\n\n    _errors.default._errorHandler(error);\n  };\n\n  var aggregateCore = function aggregateCore(aggregator) {\n    var d = new _deferred.Deferred().fail(handleError);\n    var seed;\n    var step = aggregator.step;\n    var finalize = aggregator.finalize;\n\n    try {\n      iter.reset();\n\n      if (\"seed\" in aggregator) {\n        seed = aggregator.seed;\n      } else {\n        seed = iter.next() ? iter.current() : NaN;\n      }\n\n      var accumulator = seed;\n\n      while (iter.next()) {\n        accumulator = step(accumulator, iter.current());\n      }\n\n      d.resolve(finalize ? finalize(accumulator) : accumulator);\n    } catch (x) {\n      d.reject(x);\n    }\n\n    return d.promise();\n  };\n\n  var aggregate = function aggregate(seed, step, finalize) {\n    if (arguments.length < 2) {\n      return aggregateCore({\n        step: arguments[0]\n      });\n    }\n\n    return aggregateCore({\n      seed: seed,\n      step: step,\n      finalize: finalize\n    });\n  };\n\n  var standardAggregate = function standardAggregate(name) {\n    return aggregateCore(_utils.default.aggregators[name]);\n  };\n\n  var select = function select(getter) {\n    if (!(0, _type.isFunction)(getter) && !Array.isArray(getter)) {\n      getter = [].slice.call(arguments);\n    }\n\n    return chainQuery(new SelectIterator(iter, getter));\n  };\n\n  var selectProp = function selectProp(name) {\n    return select((0, _data.compileGetter)(name));\n  };\n\n  function chainQuery(iter) {\n    return arrayQueryImpl(iter, queryOptions);\n  }\n\n  return {\n    toArray: function toArray() {\n      return iter.toArray();\n    },\n    enumerate: function enumerate() {\n      var d = new _deferred.Deferred().fail(handleError);\n\n      try {\n        d.resolve(iter.toArray());\n      } catch (x) {\n        d.reject(x);\n      }\n\n      return d.promise();\n    },\n    sortBy: function sortBy(getter, desc, compare) {\n      return chainQuery(new SortIterator(iter, getter, desc, compare));\n    },\n    thenBy: function thenBy(getter, desc, compare) {\n      if (iter instanceof SortIterator) {\n        return chainQuery(iter.thenBy(getter, desc, compare));\n      }\n\n      throw _errors.default.errors.Error(\"E4004\");\n    },\n    filter: function filter(criteria) {\n      if (!Array.isArray(criteria)) {\n        criteria = [].slice.call(arguments);\n      }\n\n      return chainQuery(new FilterIterator(iter, criteria));\n    },\n    slice: function slice(skip, take) {\n      if (void 0 === take) {\n        take = Number.MAX_VALUE;\n      }\n\n      return chainQuery(new SliceIterator(iter, skip, take));\n    },\n    select: select,\n    groupBy: function groupBy(getter) {\n      return chainQuery(new GroupIterator(iter, getter));\n    },\n    aggregate: aggregate,\n    count: function count() {\n      if (iter.countable()) {\n        var d = new _deferred.Deferred().fail(handleError);\n\n        try {\n          d.resolve(iter.count());\n        } catch (x) {\n          d.reject(x);\n        }\n\n        return d.promise();\n      }\n\n      return standardAggregate(\"count\");\n    },\n    sum: function sum(getter) {\n      if (getter) {\n        return selectProp(getter).sum();\n      }\n\n      return standardAggregate(\"sum\");\n    },\n    min: function min(getter) {\n      if (getter) {\n        return selectProp(getter).min();\n      }\n\n      return standardAggregate(\"min\");\n    },\n    max: function max(getter) {\n      if (getter) {\n        return selectProp(getter).max();\n      }\n\n      return standardAggregate(\"max\");\n    },\n    avg: function avg(getter) {\n      if (getter) {\n        return selectProp(getter).avg();\n      }\n\n      return standardAggregate(\"avg\");\n    }\n  };\n};\n\nvar _default = arrayQueryImpl;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["E:/Monday.com/quickstart-react/node_modules/devextreme/data/array_query.js"],"names":["exports","default","_class","_interopRequireDefault","require","_type","_iterator","_data","_deferred","_errors","_utils","obj","__esModule","Iterator","inherit","toArray","result","reset","next","push","current","countable","ArrayIterator","ctor","array","index","length","slice","count","WrappedIterator","iter","MapIterator","mapper","callBase","hasNext","defaultCompare","xValue","yValue","toComparable","SortIterator","getter","desc","compare","_wrap","rules","thenBy","sortedIter","concat","_ensureSorted","that","each","compileGetter","sort","x","y","_compare","_unwrap","record","value","wrappedItem","xIndex","yIndex","i","rulesCount","rule","compareResult","compileCriteria","compileGroup","crit","ops","isConjunctiveOperator","isConjunctiveNextOperator","Array","isArray","isFunction","errors","Error","d","toString","isDefined","compileBinary","normalizeBinaryCriterion","op","toLowerCase","compileEquals","indexOf","getterValue","searchValue","lastIndexOf","negate","useStrictComparison","compileUnary","criteria","isGroupCriterion","isUnaryOperation","FilterIterator","GroupIterator","_ensureGrouped","groupedIter","hash","keys","key","map","items","SelectIterator","SliceIterator","skip","take","Math","max","pos","min","arrayQueryImpl","queryOptions","handleError","error","handler","errorHandler","_errorHandler","aggregateCore","aggregator","Deferred","fail","seed","step","finalize","NaN","accumulator","resolve","reject","promise","aggregate","arguments","standardAggregate","name","aggregators","select","call","chainQuery","selectProp","enumerate","sortBy","filter","Number","MAX_VALUE","groupBy","sum","avg","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/array_query.js)\r\n * Version: 20.2.3\r\n * Build date: Tue Oct 20 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _class = _interopRequireDefault(require(\"../core/class\"));\r\nvar _type = require(\"../core/utils/type\");\r\nvar _iterator = require(\"../core/utils/iterator\");\r\nvar _data = require(\"../core/utils/data\");\r\nvar _deferred = require(\"../core/utils/deferred\");\r\nvar _errors = _interopRequireDefault(require(\"./errors\"));\r\nvar _utils = _interopRequireDefault(require(\"./utils\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar Iterator = _class.default.inherit({\r\n    toArray: function() {\r\n        var result = [];\r\n        this.reset();\r\n        while (this.next()) {\r\n            result.push(this.current())\r\n        }\r\n        return result\r\n    },\r\n    countable: function() {\r\n        return false\r\n    }\r\n});\r\nvar ArrayIterator = Iterator.inherit({\r\n    ctor: function(array) {\r\n        this.array = array;\r\n        this.index = -1\r\n    },\r\n    next: function() {\r\n        if (this.index + 1 < this.array.length) {\r\n            this.index++;\r\n            return true\r\n        }\r\n        return false\r\n    },\r\n    current: function() {\r\n        return this.array[this.index]\r\n    },\r\n    reset: function() {\r\n        this.index = -1\r\n    },\r\n    toArray: function() {\r\n        return this.array.slice(0)\r\n    },\r\n    countable: function() {\r\n        return true\r\n    },\r\n    count: function() {\r\n        return this.array.length\r\n    }\r\n});\r\nvar WrappedIterator = Iterator.inherit({\r\n    ctor: function(iter) {\r\n        this.iter = iter\r\n    },\r\n    next: function() {\r\n        return this.iter.next()\r\n    },\r\n    current: function() {\r\n        return this.iter.current()\r\n    },\r\n    reset: function() {\r\n        return this.iter.reset()\r\n    }\r\n});\r\nvar MapIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, mapper) {\r\n        this.callBase(iter);\r\n        this.index = -1;\r\n        this.mapper = mapper\r\n    },\r\n    current: function() {\r\n        return this.mapper(this.callBase(), this.index)\r\n    },\r\n    next: function() {\r\n        var hasNext = this.callBase();\r\n        if (hasNext) {\r\n            this.index++\r\n        }\r\n        return hasNext\r\n    }\r\n});\r\nvar defaultCompare = function(xValue, yValue) {\r\n    xValue = (0, _data.toComparable)(xValue);\r\n    yValue = (0, _data.toComparable)(yValue);\r\n    if (null === xValue && null !== yValue) {\r\n        return -1\r\n    }\r\n    if (null !== xValue && null === yValue) {\r\n        return 1\r\n    }\r\n    if (void 0 === xValue && void 0 !== yValue) {\r\n        return 1\r\n    }\r\n    if (void 0 !== xValue && void 0 === yValue) {\r\n        return -1\r\n    }\r\n    if (xValue < yValue) {\r\n        return -1\r\n    }\r\n    if (xValue > yValue) {\r\n        return 1\r\n    }\r\n    return 0\r\n};\r\nvar SortIterator = Iterator.inherit({\r\n    ctor: function(iter, getter, desc, compare) {\r\n        if (!(iter instanceof MapIterator)) {\r\n            iter = new MapIterator(iter, this._wrap)\r\n        }\r\n        this.iter = iter;\r\n        this.rules = [{\r\n            getter: getter,\r\n            desc: desc,\r\n            compare: compare\r\n        }]\r\n    },\r\n    thenBy: function(getter, desc, compare) {\r\n        var result = new SortIterator(this.sortedIter || this.iter, getter, desc, compare);\r\n        if (!this.sortedIter) {\r\n            result.rules = this.rules.concat(result.rules)\r\n        }\r\n        return result\r\n    },\r\n    next: function() {\r\n        this._ensureSorted();\r\n        return this.sortedIter.next()\r\n    },\r\n    current: function() {\r\n        this._ensureSorted();\r\n        return this.sortedIter.current()\r\n    },\r\n    reset: function() {\r\n        delete this.sortedIter\r\n    },\r\n    countable: function() {\r\n        return this.sortedIter || this.iter.countable()\r\n    },\r\n    count: function() {\r\n        if (this.sortedIter) {\r\n            return this.sortedIter.count()\r\n        }\r\n        return this.iter.count()\r\n    },\r\n    _ensureSorted: function() {\r\n        var that = this;\r\n        if (that.sortedIter) {\r\n            return\r\n        }(0, _iterator.each)(that.rules, function() {\r\n            this.getter = (0, _data.compileGetter)(this.getter)\r\n        });\r\n        that.sortedIter = new MapIterator(new ArrayIterator(this.iter.toArray().sort(function(x, y) {\r\n            return that._compare(x, y)\r\n        })), that._unwrap)\r\n    },\r\n    _wrap: function(record, index) {\r\n        return {\r\n            index: index,\r\n            value: record\r\n        }\r\n    },\r\n    _unwrap: function(wrappedItem) {\r\n        return wrappedItem.value\r\n    },\r\n    _compare: function(x, y) {\r\n        var xIndex = x.index;\r\n        var yIndex = y.index;\r\n        x = x.value;\r\n        y = y.value;\r\n        if (x === y) {\r\n            return xIndex - yIndex\r\n        }\r\n        for (var i = 0, rulesCount = this.rules.length; i < rulesCount; i++) {\r\n            var rule = this.rules[i];\r\n            var xValue = rule.getter(x);\r\n            var yValue = rule.getter(y);\r\n            var compare = rule.compare || defaultCompare;\r\n            var compareResult = compare(xValue, yValue);\r\n            if (compareResult) {\r\n                return rule.desc ? -compareResult : compareResult\r\n            }\r\n        }\r\n        return xIndex - yIndex\r\n    }\r\n});\r\nvar compileCriteria = function() {\r\n    var compileGroup = function(crit) {\r\n        var ops = [];\r\n        var isConjunctiveOperator = false;\r\n        var isConjunctiveNextOperator = false;\r\n        (0, _iterator.each)(crit, function() {\r\n            if (Array.isArray(this) || (0, _type.isFunction)(this)) {\r\n                if (ops.length > 1 && isConjunctiveOperator !== isConjunctiveNextOperator) {\r\n                    throw new _errors.default.errors.Error(\"E4019\")\r\n                }\r\n                ops.push(compileCriteria(this));\r\n                isConjunctiveOperator = isConjunctiveNextOperator;\r\n                isConjunctiveNextOperator = true\r\n            } else {\r\n                isConjunctiveNextOperator = _utils.default.isConjunctiveOperator(this)\r\n            }\r\n        });\r\n        return function(d) {\r\n            var result = isConjunctiveOperator;\r\n            for (var i = 0; i < ops.length; i++) {\r\n                if (ops[i](d) !== isConjunctiveOperator) {\r\n                    result = !isConjunctiveOperator;\r\n                    break\r\n                }\r\n            }\r\n            return result\r\n        }\r\n    };\r\n    var toString = function(value) {\r\n        return (0, _type.isDefined)(value) ? value.toString() : \"\"\r\n    };\r\n    var compileBinary = function(crit) {\r\n        crit = _utils.default.normalizeBinaryCriterion(crit);\r\n        var getter = (0, _data.compileGetter)(crit[0]);\r\n        var op = crit[1];\r\n        var value = crit[2];\r\n        value = (0, _data.toComparable)(value);\r\n        switch (op.toLowerCase()) {\r\n            case \"=\":\r\n                return compileEquals(getter, value);\r\n            case \"<>\":\r\n                return compileEquals(getter, value, true);\r\n            case \">\":\r\n                return function(obj) {\r\n                    return (0, _data.toComparable)(getter(obj)) > value\r\n                };\r\n            case \"<\":\r\n                return function(obj) {\r\n                    return (0, _data.toComparable)(getter(obj)) < value\r\n                };\r\n            case \">=\":\r\n                return function(obj) {\r\n                    return (0, _data.toComparable)(getter(obj)) >= value\r\n                };\r\n            case \"<=\":\r\n                return function(obj) {\r\n                    return (0, _data.toComparable)(getter(obj)) <= value\r\n                };\r\n            case \"startswith\":\r\n                return function(obj) {\r\n                    return 0 === (0, _data.toComparable)(toString(getter(obj))).indexOf(value)\r\n                };\r\n            case \"endswith\":\r\n                return function(obj) {\r\n                    var getterValue = (0, _data.toComparable)(toString(getter(obj)));\r\n                    var searchValue = toString(value);\r\n                    if (getterValue.length < searchValue.length) {\r\n                        return false\r\n                    }\r\n                    return getterValue.lastIndexOf(value) === getterValue.length - value.length\r\n                };\r\n            case \"contains\":\r\n                return function(obj) {\r\n                    return (0, _data.toComparable)(toString(getter(obj))).indexOf(value) > -1\r\n                };\r\n            case \"notcontains\":\r\n                return function(obj) {\r\n                    return (0, _data.toComparable)(toString(getter(obj))).indexOf(value) === -1\r\n                }\r\n        }\r\n        throw _errors.default.errors.Error(\"E4003\", op)\r\n    };\r\n\r\n    function compileEquals(getter, value, negate) {\r\n        return function(obj) {\r\n            obj = (0, _data.toComparable)(getter(obj));\r\n            var result = useStrictComparison(value) ? obj === value : obj == value;\r\n            if (negate) {\r\n                result = !result\r\n            }\r\n            return result\r\n        }\r\n    }\r\n\r\n    function useStrictComparison(value) {\r\n        return \"\" === value || 0 === value || false === value\r\n    }\r\n\r\n    function compileUnary(crit) {\r\n        var op = crit[0];\r\n        var criteria = compileCriteria(crit[1]);\r\n        if (\"!\" === op) {\r\n            return function(obj) {\r\n                return !criteria(obj)\r\n            }\r\n        }\r\n        throw _errors.default.errors.Error(\"E4003\", op)\r\n    }\r\n    return function(crit) {\r\n        if ((0, _type.isFunction)(crit)) {\r\n            return crit\r\n        }\r\n        if (_utils.default.isGroupCriterion(crit)) {\r\n            return compileGroup(crit)\r\n        }\r\n        if (_utils.default.isUnaryOperation(crit)) {\r\n            return compileUnary(crit)\r\n        }\r\n        return compileBinary(crit)\r\n    }\r\n}();\r\nvar FilterIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, criteria) {\r\n        this.callBase(iter);\r\n        this.criteria = compileCriteria(criteria)\r\n    },\r\n    next: function() {\r\n        while (this.iter.next()) {\r\n            if (this.criteria(this.current())) {\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    }\r\n});\r\nvar GroupIterator = Iterator.inherit({\r\n    ctor: function(iter, getter) {\r\n        this.iter = iter;\r\n        this.getter = getter\r\n    },\r\n    next: function() {\r\n        this._ensureGrouped();\r\n        return this.groupedIter.next()\r\n    },\r\n    current: function() {\r\n        this._ensureGrouped();\r\n        return this.groupedIter.current()\r\n    },\r\n    reset: function() {\r\n        delete this.groupedIter\r\n    },\r\n    countable: function() {\r\n        return !!this.groupedIter\r\n    },\r\n    count: function() {\r\n        return this.groupedIter.count()\r\n    },\r\n    _ensureGrouped: function() {\r\n        if (this.groupedIter) {\r\n            return\r\n        }\r\n        var hash = {};\r\n        var keys = [];\r\n        var iter = this.iter;\r\n        var getter = (0, _data.compileGetter)(this.getter);\r\n        iter.reset();\r\n        while (iter.next()) {\r\n            var current = iter.current();\r\n            var key = getter(current);\r\n            if (key in hash) {\r\n                hash[key].push(current)\r\n            } else {\r\n                hash[key] = [current];\r\n                keys.push(key)\r\n            }\r\n        }\r\n        this.groupedIter = new ArrayIterator((0, _iterator.map)(keys, function(key) {\r\n            return {\r\n                key: key,\r\n                items: hash[key]\r\n            }\r\n        }))\r\n    }\r\n});\r\nvar SelectIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, getter) {\r\n        this.callBase(iter);\r\n        this.getter = (0, _data.compileGetter)(getter)\r\n    },\r\n    current: function() {\r\n        return this.getter(this.callBase())\r\n    },\r\n    countable: function() {\r\n        return this.iter.countable()\r\n    },\r\n    count: function() {\r\n        return this.iter.count()\r\n    }\r\n});\r\nvar SliceIterator = WrappedIterator.inherit({\r\n    ctor: function(iter, skip, take) {\r\n        this.callBase(iter);\r\n        this.skip = Math.max(0, skip);\r\n        this.take = Math.max(0, take);\r\n        this.pos = 0\r\n    },\r\n    next: function() {\r\n        if (this.pos >= this.skip + this.take) {\r\n            return false\r\n        }\r\n        while (this.pos < this.skip && this.iter.next()) {\r\n            this.pos++\r\n        }\r\n        this.pos++;\r\n        return this.iter.next()\r\n    },\r\n    reset: function() {\r\n        this.callBase();\r\n        this.pos = 0\r\n    },\r\n    countable: function() {\r\n        return this.iter.countable()\r\n    },\r\n    count: function() {\r\n        return Math.min(this.iter.count() - this.skip, this.take)\r\n    }\r\n});\r\nvar arrayQueryImpl = function arrayQueryImpl(iter, queryOptions) {\r\n    queryOptions = queryOptions || {};\r\n    if (!(iter instanceof Iterator)) {\r\n        iter = new ArrayIterator(iter)\r\n    }\r\n    var handleError = function(error) {\r\n        var handler = queryOptions.errorHandler;\r\n        if (handler) {\r\n            handler(error)\r\n        }\r\n        _errors.default._errorHandler(error)\r\n    };\r\n    var aggregateCore = function(aggregator) {\r\n        var d = (new _deferred.Deferred).fail(handleError);\r\n        var seed;\r\n        var step = aggregator.step;\r\n        var finalize = aggregator.finalize;\r\n        try {\r\n            iter.reset();\r\n            if (\"seed\" in aggregator) {\r\n                seed = aggregator.seed\r\n            } else {\r\n                seed = iter.next() ? iter.current() : NaN\r\n            }\r\n            var accumulator = seed;\r\n            while (iter.next()) {\r\n                accumulator = step(accumulator, iter.current())\r\n            }\r\n            d.resolve(finalize ? finalize(accumulator) : accumulator)\r\n        } catch (x) {\r\n            d.reject(x)\r\n        }\r\n        return d.promise()\r\n    };\r\n    var aggregate = function(seed, step, finalize) {\r\n        if (arguments.length < 2) {\r\n            return aggregateCore({\r\n                step: arguments[0]\r\n            })\r\n        }\r\n        return aggregateCore({\r\n            seed: seed,\r\n            step: step,\r\n            finalize: finalize\r\n        })\r\n    };\r\n    var standardAggregate = function(name) {\r\n        return aggregateCore(_utils.default.aggregators[name])\r\n    };\r\n    var select = function(getter) {\r\n        if (!(0, _type.isFunction)(getter) && !Array.isArray(getter)) {\r\n            getter = [].slice.call(arguments)\r\n        }\r\n        return chainQuery(new SelectIterator(iter, getter))\r\n    };\r\n    var selectProp = function(name) {\r\n        return select((0, _data.compileGetter)(name))\r\n    };\r\n\r\n    function chainQuery(iter) {\r\n        return arrayQueryImpl(iter, queryOptions)\r\n    }\r\n    return {\r\n        toArray: function() {\r\n            return iter.toArray()\r\n        },\r\n        enumerate: function() {\r\n            var d = (new _deferred.Deferred).fail(handleError);\r\n            try {\r\n                d.resolve(iter.toArray())\r\n            } catch (x) {\r\n                d.reject(x)\r\n            }\r\n            return d.promise()\r\n        },\r\n        sortBy: function(getter, desc, compare) {\r\n            return chainQuery(new SortIterator(iter, getter, desc, compare))\r\n        },\r\n        thenBy: function(getter, desc, compare) {\r\n            if (iter instanceof SortIterator) {\r\n                return chainQuery(iter.thenBy(getter, desc, compare))\r\n            }\r\n            throw _errors.default.errors.Error(\"E4004\")\r\n        },\r\n        filter: function(criteria) {\r\n            if (!Array.isArray(criteria)) {\r\n                criteria = [].slice.call(arguments)\r\n            }\r\n            return chainQuery(new FilterIterator(iter, criteria))\r\n        },\r\n        slice: function(skip, take) {\r\n            if (void 0 === take) {\r\n                take = Number.MAX_VALUE\r\n            }\r\n            return chainQuery(new SliceIterator(iter, skip, take))\r\n        },\r\n        select: select,\r\n        groupBy: function(getter) {\r\n            return chainQuery(new GroupIterator(iter, getter))\r\n        },\r\n        aggregate: aggregate,\r\n        count: function() {\r\n            if (iter.countable()) {\r\n                var d = (new _deferred.Deferred).fail(handleError);\r\n                try {\r\n                    d.resolve(iter.count())\r\n                } catch (x) {\r\n                    d.reject(x)\r\n                }\r\n                return d.promise()\r\n            }\r\n            return standardAggregate(\"count\")\r\n        },\r\n        sum: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).sum()\r\n            }\r\n            return standardAggregate(\"sum\")\r\n        },\r\n        min: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).min()\r\n            }\r\n            return standardAggregate(\"min\")\r\n        },\r\n        max: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).max()\r\n            }\r\n            return standardAggregate(\"max\")\r\n        },\r\n        avg: function(getter) {\r\n            if (getter) {\r\n                return selectProp(getter).avg()\r\n            }\r\n            return standardAggregate(\"avg\")\r\n        }\r\n    }\r\n};\r\nvar _default = arrayQueryImpl;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}