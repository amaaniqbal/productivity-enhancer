{"ast":null,"code":"/**\r\n * DevExtreme (data/custom_store.js)\r\n * Version: 20.2.3\r\n * Build date: Tue Oct 20 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../core/renderer\"));\n\nvar _utils = _interopRequireDefault(require(\"./utils\"));\n\nvar _array_utils = require(\"./array_utils\");\n\nvar _type = require(\"../core/utils/type\");\n\nvar _config = _interopRequireDefault(require(\"../core/config\"));\n\nvar _errors = _interopRequireDefault(require(\"./errors\"));\n\nvar _abstract_store = _interopRequireDefault(require(\"./abstract_store\"));\n\nvar _array_query = _interopRequireDefault(require(\"./array_query\"));\n\nvar _store_helper = _interopRequireDefault(require(\"./store_helper\"));\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar TOTAL_COUNT = \"totalCount\";\nvar LOAD = \"load\";\nvar BY_KEY = \"byKey\";\nvar INSERT = \"insert\";\nvar UPDATE = \"update\";\nvar REMOVE = \"remove\";\n\nfunction isPromise(obj) {\n  return obj && (0, _type.isFunction)(obj.then);\n}\n\nfunction trivialPromise(value) {\n  return new _deferred.Deferred().resolve(value).promise();\n}\n\nfunction ensureRequiredFuncOption(name, obj) {\n  if (!(0, _type.isFunction)(obj)) {\n    throw _errors.default.errors.Error(\"E4011\", name);\n  }\n}\n\nfunction throwInvalidUserFuncResult(name) {\n  throw _errors.default.errors.Error(\"E4012\", name);\n}\n\nfunction createUserFuncFailureHandler(pendingDeferred) {\n  function errorMessageFromXhr(promiseArguments) {\n    var xhr = promiseArguments[0];\n    var textStatus = promiseArguments[1];\n\n    if (!xhr || !xhr.getResponseHeader) {\n      return null;\n    }\n\n    return _utils.default.errorMessageFromXhr(xhr, textStatus);\n  }\n\n  return function (arg) {\n    var error;\n\n    if (arg instanceof Error) {\n      error = arg;\n    } else {\n      error = new Error(errorMessageFromXhr(arguments) || arg && String(arg) || \"Unknown error\");\n    }\n\n    if (error.message !== _utils.default.XHR_ERROR_UNLOAD) {\n      pendingDeferred.reject(error);\n    }\n  };\n}\n\nfunction invokeUserLoad(store, options) {\n  var userFunc = store._loadFunc;\n  var userResult;\n  ensureRequiredFuncOption(LOAD, userFunc);\n  userResult = userFunc.apply(store, [options]);\n\n  if (Array.isArray(userResult)) {\n    userResult = trivialPromise(userResult);\n  } else {\n    if (null === userResult || void 0 === userResult) {\n      userResult = trivialPromise([]);\n    } else {\n      if (!isPromise(userResult)) {\n        throwInvalidUserFuncResult(LOAD);\n      }\n    }\n  }\n\n  return (0, _deferred.fromPromise)(userResult);\n}\n\nfunction invokeUserTotalCountFunc(store, options) {\n  var userFunc = store._totalCountFunc;\n  var userResult;\n\n  if (!(0, _type.isFunction)(userFunc)) {\n    throw _errors.default.errors.Error(\"E4021\");\n  }\n\n  userResult = userFunc.apply(store, [options]);\n\n  if (!isPromise(userResult)) {\n    userResult = Number(userResult);\n\n    if (!isFinite(userResult)) {\n      throwInvalidUserFuncResult(TOTAL_COUNT);\n    }\n\n    userResult = trivialPromise(userResult);\n  }\n\n  return (0, _deferred.fromPromise)(userResult);\n}\n\nfunction invokeUserByKeyFunc(store, key, extraOptions) {\n  var userFunc = store._byKeyFunc;\n  var userResult;\n  ensureRequiredFuncOption(BY_KEY, userFunc);\n  userResult = userFunc.apply(store, [key, extraOptions]);\n\n  if (!isPromise(userResult)) {\n    userResult = trivialPromise(userResult);\n  }\n\n  return (0, _deferred.fromPromise)(userResult);\n}\n\nfunction runRawLoad(pendingDeferred, store, userFuncOptions, continuation) {\n  if (store.__rawData) {\n    continuation(store.__rawData);\n  } else {\n    var loadPromise = store.__rawDataPromise || invokeUserLoad(store, userFuncOptions);\n\n    if (store._cacheRawData) {\n      store.__rawDataPromise = loadPromise;\n    }\n\n    loadPromise.always(function () {\n      delete store.__rawDataPromise;\n    }).done(function (rawData) {\n      if (store._cacheRawData) {\n        store.__rawData = rawData;\n      }\n\n      continuation(rawData);\n    }).fail(createUserFuncFailureHandler(pendingDeferred));\n  }\n}\n\nfunction runRawLoadWithQuery(pendingDeferred, store, options, countOnly) {\n  options = options || {};\n  var userFuncOptions = {};\n\n  if (\"userData\" in options) {\n    userFuncOptions.userData = options.userData;\n  }\n\n  runRawLoad(pendingDeferred, store, userFuncOptions, function (rawData) {\n    var rawDataQuery = (0, _array_query.default)(rawData, {\n      errorHandler: store._errorHandler\n    });\n    var itemsQuery;\n    var totalCountQuery;\n    var waitList = [];\n    var items;\n    var totalCount;\n\n    if (!countOnly) {\n      itemsQuery = _store_helper.default.queryByOptions(rawDataQuery, options);\n\n      if (itemsQuery === rawDataQuery) {\n        items = rawData.slice(0);\n      } else {\n        waitList.push(itemsQuery.enumerate().done(function (asyncResult) {\n          items = asyncResult;\n        }));\n      }\n    }\n\n    if (options.requireTotalCount || countOnly) {\n      totalCountQuery = _store_helper.default.queryByOptions(rawDataQuery, options, true);\n\n      if (totalCountQuery === rawDataQuery) {\n        totalCount = rawData.length;\n      } else {\n        waitList.push(totalCountQuery.count().done(function (asyncResult) {\n          totalCount = asyncResult;\n        }));\n      }\n    }\n\n    _deferred.when.apply(_renderer.default, waitList).done(function () {\n      if (countOnly) {\n        pendingDeferred.resolve(totalCount);\n      } else {\n        if (options.requireTotalCount) {\n          pendingDeferred.resolve(items, {\n            totalCount: totalCount\n          });\n        } else {\n          pendingDeferred.resolve(items);\n        }\n      }\n    }).fail(function (x) {\n      pendingDeferred.reject(x);\n    });\n  });\n}\n\nfunction runRawLoadWithKey(pendingDeferred, store, key) {\n  runRawLoad(pendingDeferred, store, {}, function (rawData) {\n    var keyExpr = store.key();\n    var item;\n\n    for (var i = 0, len = rawData.length; i < len; i++) {\n      item = rawData[i];\n\n      if (_utils.default.keysEqual(keyExpr, store.keyOf(rawData[i]), key)) {\n        pendingDeferred.resolve(item);\n        return;\n      }\n    }\n\n    pendingDeferred.reject(_errors.default.errors.Error(\"E4009\"));\n  });\n}\n\nvar CustomStore = _abstract_store.default.inherit({\n  ctor: function ctor(options) {\n    options = options || {};\n    this.callBase(options);\n    this._useDefaultSearch = !!options.useDefaultSearch || \"raw\" === options.loadMode;\n    this._loadMode = options.loadMode;\n    this._cacheRawData = false !== options.cacheRawData;\n    this._loadFunc = options[LOAD];\n    this._totalCountFunc = options[TOTAL_COUNT];\n    this._byKeyFunc = options[BY_KEY];\n    this._insertFunc = options[INSERT];\n    this._updateFunc = options[UPDATE];\n    this._removeFunc = options[REMOVE];\n  },\n  createQuery: function createQuery() {\n    throw _errors.default.errors.Error(\"E4010\");\n  },\n  clearRawDataCache: function clearRawDataCache() {\n    delete this.__rawData;\n  },\n  _totalCountImpl: function _totalCountImpl(options) {\n    var d = new _deferred.Deferred();\n\n    if (\"raw\" === this._loadMode && !this._totalCountFunc) {\n      runRawLoadWithQuery(d, this, options, true);\n    } else {\n      invokeUserTotalCountFunc(this, options).done(function (count) {\n        d.resolve(Number(count));\n      }).fail(createUserFuncFailureHandler(d));\n      d = this._addFailHandlers(d);\n    }\n\n    return d.promise();\n  },\n  _pushImpl: function _pushImpl(changes) {\n    if (this.__rawData) {\n      (0, _array_utils.applyBatch)({\n        keyInfo: this,\n        data: this.__rawData,\n        changes: changes\n      });\n    }\n  },\n  _loadImpl: function _loadImpl(options) {\n    var d = new _deferred.Deferred();\n\n    if (\"raw\" === this._loadMode) {\n      runRawLoadWithQuery(d, this, options, false);\n    } else {\n      invokeUserLoad(this, options).done(function (data, extra) {\n        d.resolve(data, extra);\n      }).fail(createUserFuncFailureHandler(d));\n      d = this._addFailHandlers(d);\n    }\n\n    return d.promise();\n  },\n  _byKeyImpl: function _byKeyImpl(key, extraOptions) {\n    var d = new _deferred.Deferred();\n\n    if (this._byKeyViaLoad()) {\n      this._requireKey();\n\n      runRawLoadWithKey(d, this, key);\n    } else {\n      invokeUserByKeyFunc(this, key, extraOptions).done(function (obj) {\n        d.resolve(obj);\n      }).fail(createUserFuncFailureHandler(d));\n    }\n\n    return d.promise();\n  },\n  _byKeyViaLoad: function _byKeyViaLoad() {\n    return \"raw\" === this._loadMode && !this._byKeyFunc;\n  },\n  _insertImpl: function _insertImpl(values) {\n    var that = this;\n    var userFunc = that._insertFunc;\n    var userResult;\n    var d = new _deferred.Deferred();\n    ensureRequiredFuncOption(INSERT, userFunc);\n    userResult = userFunc.apply(that, [values]);\n\n    if (!isPromise(userResult)) {\n      userResult = trivialPromise(userResult);\n    }\n\n    (0, _deferred.fromPromise)(userResult).done(function (serverResponse) {\n      if ((0, _config.default)().useLegacyStoreResult) {\n        d.resolve(values, serverResponse);\n      } else {\n        d.resolve(serverResponse || values, that.keyOf(serverResponse));\n      }\n    }).fail(createUserFuncFailureHandler(d));\n    return d.promise();\n  },\n  _updateImpl: function _updateImpl(key, values) {\n    var userFunc = this._updateFunc;\n    var userResult;\n    var d = new _deferred.Deferred();\n    ensureRequiredFuncOption(UPDATE, userFunc);\n    userResult = userFunc.apply(this, [key, values]);\n\n    if (!isPromise(userResult)) {\n      userResult = trivialPromise(userResult);\n    }\n\n    (0, _deferred.fromPromise)(userResult).done(function (serverResponse) {\n      if ((0, _config.default)().useLegacyStoreResult) {\n        d.resolve(key, values);\n      } else {\n        d.resolve(serverResponse || values, key);\n      }\n    }).fail(createUserFuncFailureHandler(d));\n    return d.promise();\n  },\n  _removeImpl: function _removeImpl(key) {\n    var userFunc = this._removeFunc;\n    var userResult;\n    var d = new _deferred.Deferred();\n    ensureRequiredFuncOption(REMOVE, userFunc);\n    userResult = userFunc.apply(this, [key]);\n\n    if (!isPromise(userResult)) {\n      userResult = trivialPromise();\n    }\n\n    (0, _deferred.fromPromise)(userResult).done(function () {\n      d.resolve(key);\n    }).fail(createUserFuncFailureHandler(d));\n    return d.promise();\n  }\n});\n\nvar _default = CustomStore;\nexports.default = _default;\nmodule.exports = exports.default;\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["E:/Monday.com/quickstart-react/node_modules/devextreme/data/custom_store.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_utils","_array_utils","_type","_config","_errors","_abstract_store","_array_query","_store_helper","_deferred","obj","__esModule","TOTAL_COUNT","LOAD","BY_KEY","INSERT","UPDATE","REMOVE","isPromise","isFunction","then","trivialPromise","value","Deferred","resolve","promise","ensureRequiredFuncOption","name","errors","Error","throwInvalidUserFuncResult","createUserFuncFailureHandler","pendingDeferred","errorMessageFromXhr","promiseArguments","xhr","textStatus","getResponseHeader","arg","error","arguments","String","message","XHR_ERROR_UNLOAD","reject","invokeUserLoad","store","options","userFunc","_loadFunc","userResult","apply","Array","isArray","fromPromise","invokeUserTotalCountFunc","_totalCountFunc","Number","isFinite","invokeUserByKeyFunc","key","extraOptions","_byKeyFunc","runRawLoad","userFuncOptions","continuation","__rawData","loadPromise","__rawDataPromise","_cacheRawData","always","done","rawData","fail","runRawLoadWithQuery","countOnly","userData","rawDataQuery","errorHandler","_errorHandler","itemsQuery","totalCountQuery","waitList","items","totalCount","queryByOptions","slice","push","enumerate","asyncResult","requireTotalCount","length","count","when","x","runRawLoadWithKey","keyExpr","item","i","len","keysEqual","keyOf","CustomStore","inherit","ctor","callBase","_useDefaultSearch","useDefaultSearch","loadMode","_loadMode","cacheRawData","_insertFunc","_updateFunc","_removeFunc","createQuery","clearRawDataCache","_totalCountImpl","d","_addFailHandlers","_pushImpl","changes","applyBatch","keyInfo","data","_loadImpl","extra","_byKeyImpl","_byKeyViaLoad","_requireKey","_insertImpl","values","that","serverResponse","useLegacyStoreResult","_updateImpl","_removeImpl","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/custom_store.js)\r\n * Version: 20.2.3\r\n * Build date: Tue Oct 20 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../core/renderer\"));\r\nvar _utils = _interopRequireDefault(require(\"./utils\"));\r\nvar _array_utils = require(\"./array_utils\");\r\nvar _type = require(\"../core/utils/type\");\r\nvar _config = _interopRequireDefault(require(\"../core/config\"));\r\nvar _errors = _interopRequireDefault(require(\"./errors\"));\r\nvar _abstract_store = _interopRequireDefault(require(\"./abstract_store\"));\r\nvar _array_query = _interopRequireDefault(require(\"./array_query\"));\r\nvar _store_helper = _interopRequireDefault(require(\"./store_helper\"));\r\nvar _deferred = require(\"../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar TOTAL_COUNT = \"totalCount\";\r\nvar LOAD = \"load\";\r\nvar BY_KEY = \"byKey\";\r\nvar INSERT = \"insert\";\r\nvar UPDATE = \"update\";\r\nvar REMOVE = \"remove\";\r\n\r\nfunction isPromise(obj) {\r\n    return obj && (0, _type.isFunction)(obj.then)\r\n}\r\n\r\nfunction trivialPromise(value) {\r\n    return (new _deferred.Deferred).resolve(value).promise()\r\n}\r\n\r\nfunction ensureRequiredFuncOption(name, obj) {\r\n    if (!(0, _type.isFunction)(obj)) {\r\n        throw _errors.default.errors.Error(\"E4011\", name)\r\n    }\r\n}\r\n\r\nfunction throwInvalidUserFuncResult(name) {\r\n    throw _errors.default.errors.Error(\"E4012\", name)\r\n}\r\n\r\nfunction createUserFuncFailureHandler(pendingDeferred) {\r\n    function errorMessageFromXhr(promiseArguments) {\r\n        var xhr = promiseArguments[0];\r\n        var textStatus = promiseArguments[1];\r\n        if (!xhr || !xhr.getResponseHeader) {\r\n            return null\r\n        }\r\n        return _utils.default.errorMessageFromXhr(xhr, textStatus)\r\n    }\r\n    return function(arg) {\r\n        var error;\r\n        if (arg instanceof Error) {\r\n            error = arg\r\n        } else {\r\n            error = new Error(errorMessageFromXhr(arguments) || arg && String(arg) || \"Unknown error\")\r\n        }\r\n        if (error.message !== _utils.default.XHR_ERROR_UNLOAD) {\r\n            pendingDeferred.reject(error)\r\n        }\r\n    }\r\n}\r\n\r\nfunction invokeUserLoad(store, options) {\r\n    var userFunc = store._loadFunc;\r\n    var userResult;\r\n    ensureRequiredFuncOption(LOAD, userFunc);\r\n    userResult = userFunc.apply(store, [options]);\r\n    if (Array.isArray(userResult)) {\r\n        userResult = trivialPromise(userResult)\r\n    } else {\r\n        if (null === userResult || void 0 === userResult) {\r\n            userResult = trivialPromise([])\r\n        } else {\r\n            if (!isPromise(userResult)) {\r\n                throwInvalidUserFuncResult(LOAD)\r\n            }\r\n        }\r\n    }\r\n    return (0, _deferred.fromPromise)(userResult)\r\n}\r\n\r\nfunction invokeUserTotalCountFunc(store, options) {\r\n    var userFunc = store._totalCountFunc;\r\n    var userResult;\r\n    if (!(0, _type.isFunction)(userFunc)) {\r\n        throw _errors.default.errors.Error(\"E4021\")\r\n    }\r\n    userResult = userFunc.apply(store, [options]);\r\n    if (!isPromise(userResult)) {\r\n        userResult = Number(userResult);\r\n        if (!isFinite(userResult)) {\r\n            throwInvalidUserFuncResult(TOTAL_COUNT)\r\n        }\r\n        userResult = trivialPromise(userResult)\r\n    }\r\n    return (0, _deferred.fromPromise)(userResult)\r\n}\r\n\r\nfunction invokeUserByKeyFunc(store, key, extraOptions) {\r\n    var userFunc = store._byKeyFunc;\r\n    var userResult;\r\n    ensureRequiredFuncOption(BY_KEY, userFunc);\r\n    userResult = userFunc.apply(store, [key, extraOptions]);\r\n    if (!isPromise(userResult)) {\r\n        userResult = trivialPromise(userResult)\r\n    }\r\n    return (0, _deferred.fromPromise)(userResult)\r\n}\r\n\r\nfunction runRawLoad(pendingDeferred, store, userFuncOptions, continuation) {\r\n    if (store.__rawData) {\r\n        continuation(store.__rawData)\r\n    } else {\r\n        var loadPromise = store.__rawDataPromise || invokeUserLoad(store, userFuncOptions);\r\n        if (store._cacheRawData) {\r\n            store.__rawDataPromise = loadPromise\r\n        }\r\n        loadPromise.always(function() {\r\n            delete store.__rawDataPromise\r\n        }).done(function(rawData) {\r\n            if (store._cacheRawData) {\r\n                store.__rawData = rawData\r\n            }\r\n            continuation(rawData)\r\n        }).fail(createUserFuncFailureHandler(pendingDeferred))\r\n    }\r\n}\r\n\r\nfunction runRawLoadWithQuery(pendingDeferred, store, options, countOnly) {\r\n    options = options || {};\r\n    var userFuncOptions = {};\r\n    if (\"userData\" in options) {\r\n        userFuncOptions.userData = options.userData\r\n    }\r\n    runRawLoad(pendingDeferred, store, userFuncOptions, function(rawData) {\r\n        var rawDataQuery = (0, _array_query.default)(rawData, {\r\n            errorHandler: store._errorHandler\r\n        });\r\n        var itemsQuery;\r\n        var totalCountQuery;\r\n        var waitList = [];\r\n        var items;\r\n        var totalCount;\r\n        if (!countOnly) {\r\n            itemsQuery = _store_helper.default.queryByOptions(rawDataQuery, options);\r\n            if (itemsQuery === rawDataQuery) {\r\n                items = rawData.slice(0)\r\n            } else {\r\n                waitList.push(itemsQuery.enumerate().done(function(asyncResult) {\r\n                    items = asyncResult\r\n                }))\r\n            }\r\n        }\r\n        if (options.requireTotalCount || countOnly) {\r\n            totalCountQuery = _store_helper.default.queryByOptions(rawDataQuery, options, true);\r\n            if (totalCountQuery === rawDataQuery) {\r\n                totalCount = rawData.length\r\n            } else {\r\n                waitList.push(totalCountQuery.count().done(function(asyncResult) {\r\n                    totalCount = asyncResult\r\n                }))\r\n            }\r\n        }\r\n        _deferred.when.apply(_renderer.default, waitList).done(function() {\r\n            if (countOnly) {\r\n                pendingDeferred.resolve(totalCount)\r\n            } else {\r\n                if (options.requireTotalCount) {\r\n                    pendingDeferred.resolve(items, {\r\n                        totalCount: totalCount\r\n                    })\r\n                } else {\r\n                    pendingDeferred.resolve(items)\r\n                }\r\n            }\r\n        }).fail(function(x) {\r\n            pendingDeferred.reject(x)\r\n        })\r\n    })\r\n}\r\n\r\nfunction runRawLoadWithKey(pendingDeferred, store, key) {\r\n    runRawLoad(pendingDeferred, store, {}, function(rawData) {\r\n        var keyExpr = store.key();\r\n        var item;\r\n        for (var i = 0, len = rawData.length; i < len; i++) {\r\n            item = rawData[i];\r\n            if (_utils.default.keysEqual(keyExpr, store.keyOf(rawData[i]), key)) {\r\n                pendingDeferred.resolve(item);\r\n                return\r\n            }\r\n        }\r\n        pendingDeferred.reject(_errors.default.errors.Error(\"E4009\"))\r\n    })\r\n}\r\nvar CustomStore = _abstract_store.default.inherit({\r\n    ctor: function(options) {\r\n        options = options || {};\r\n        this.callBase(options);\r\n        this._useDefaultSearch = !!options.useDefaultSearch || \"raw\" === options.loadMode;\r\n        this._loadMode = options.loadMode;\r\n        this._cacheRawData = false !== options.cacheRawData;\r\n        this._loadFunc = options[LOAD];\r\n        this._totalCountFunc = options[TOTAL_COUNT];\r\n        this._byKeyFunc = options[BY_KEY];\r\n        this._insertFunc = options[INSERT];\r\n        this._updateFunc = options[UPDATE];\r\n        this._removeFunc = options[REMOVE]\r\n    },\r\n    createQuery: function() {\r\n        throw _errors.default.errors.Error(\"E4010\")\r\n    },\r\n    clearRawDataCache: function() {\r\n        delete this.__rawData\r\n    },\r\n    _totalCountImpl: function(options) {\r\n        var d = new _deferred.Deferred;\r\n        if (\"raw\" === this._loadMode && !this._totalCountFunc) {\r\n            runRawLoadWithQuery(d, this, options, true)\r\n        } else {\r\n            invokeUserTotalCountFunc(this, options).done(function(count) {\r\n                d.resolve(Number(count))\r\n            }).fail(createUserFuncFailureHandler(d));\r\n            d = this._addFailHandlers(d)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _pushImpl: function(changes) {\r\n        if (this.__rawData) {\r\n            (0, _array_utils.applyBatch)({\r\n                keyInfo: this,\r\n                data: this.__rawData,\r\n                changes: changes\r\n            })\r\n        }\r\n    },\r\n    _loadImpl: function(options) {\r\n        var d = new _deferred.Deferred;\r\n        if (\"raw\" === this._loadMode) {\r\n            runRawLoadWithQuery(d, this, options, false)\r\n        } else {\r\n            invokeUserLoad(this, options).done(function(data, extra) {\r\n                d.resolve(data, extra)\r\n            }).fail(createUserFuncFailureHandler(d));\r\n            d = this._addFailHandlers(d)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _byKeyImpl: function(key, extraOptions) {\r\n        var d = new _deferred.Deferred;\r\n        if (this._byKeyViaLoad()) {\r\n            this._requireKey();\r\n            runRawLoadWithKey(d, this, key)\r\n        } else {\r\n            invokeUserByKeyFunc(this, key, extraOptions).done(function(obj) {\r\n                d.resolve(obj)\r\n            }).fail(createUserFuncFailureHandler(d))\r\n        }\r\n        return d.promise()\r\n    },\r\n    _byKeyViaLoad: function() {\r\n        return \"raw\" === this._loadMode && !this._byKeyFunc\r\n    },\r\n    _insertImpl: function(values) {\r\n        var that = this;\r\n        var userFunc = that._insertFunc;\r\n        var userResult;\r\n        var d = new _deferred.Deferred;\r\n        ensureRequiredFuncOption(INSERT, userFunc);\r\n        userResult = userFunc.apply(that, [values]);\r\n        if (!isPromise(userResult)) {\r\n            userResult = trivialPromise(userResult)\r\n        }(0, _deferred.fromPromise)(userResult).done(function(serverResponse) {\r\n            if ((0, _config.default)().useLegacyStoreResult) {\r\n                d.resolve(values, serverResponse)\r\n            } else {\r\n                d.resolve(serverResponse || values, that.keyOf(serverResponse))\r\n            }\r\n        }).fail(createUserFuncFailureHandler(d));\r\n        return d.promise()\r\n    },\r\n    _updateImpl: function(key, values) {\r\n        var userFunc = this._updateFunc;\r\n        var userResult;\r\n        var d = new _deferred.Deferred;\r\n        ensureRequiredFuncOption(UPDATE, userFunc);\r\n        userResult = userFunc.apply(this, [key, values]);\r\n        if (!isPromise(userResult)) {\r\n            userResult = trivialPromise(userResult)\r\n        }(0, _deferred.fromPromise)(userResult).done(function(serverResponse) {\r\n            if ((0, _config.default)().useLegacyStoreResult) {\r\n                d.resolve(key, values)\r\n            } else {\r\n                d.resolve(serverResponse || values, key)\r\n            }\r\n        }).fail(createUserFuncFailureHandler(d));\r\n        return d.promise()\r\n    },\r\n    _removeImpl: function(key) {\r\n        var userFunc = this._removeFunc;\r\n        var userResult;\r\n        var d = new _deferred.Deferred;\r\n        ensureRequiredFuncOption(REMOVE, userFunc);\r\n        userResult = userFunc.apply(this, [key]);\r\n        if (!isPromise(userResult)) {\r\n            userResult = trivialPromise()\r\n        }(0, _deferred.fromPromise)(userResult).done(function() {\r\n            d.resolve(key)\r\n        }).fail(createUserFuncFailureHandler(d));\r\n        return d.promise()\r\n    }\r\n});\r\nvar _default = CustomStore;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"script"}