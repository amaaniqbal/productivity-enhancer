{"ast":null,"code":"/**\r\n * DevExtreme (viz/components/legend.js)\r\n * Version: 20.2.3\r\n * Build date: Tue Oct 20 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.plugin = exports.Legend = void 0;\n\nvar _utils = require(\"../core/utils\");\n\nvar _extend2 = require(\"../../core/utils/extend\");\n\nvar _layout_element = require(\"../core/layout_element\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _title = require(\"../core/title\");\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _renderer = require(\"../core/renderers/renderer\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _Number = Number;\nvar _math = Math;\nvar _round = _math.round;\nvar _max = _math.max;\nvar _min = _math.min;\nvar _ceil = _math.ceil;\nvar _isDefined = _type.isDefined;\nvar _isFunction = _type.isFunction;\nvar _enumParser = _utils.enumParser;\nvar _normalizeEnum = _utils.normalizeEnum;\nvar _extend = _extend2.extend;\nvar DEFAULT_MARGIN = 10;\nvar DEFAULT_MARKER_HATCHING_WIDTH = 2;\nvar DEFAULT_MARKER_HATCHING_STEP = 5;\nvar CENTER = \"center\";\nvar RIGHT = \"right\";\nvar LEFT = \"left\";\nvar TOP = \"top\";\nvar BOTTOM = \"bottom\";\nvar HORIZONTAL = \"horizontal\";\nvar VERTICAL = \"vertical\";\nvar INSIDE = \"inside\";\nvar OUTSIDE = \"outside\";\nvar NONE = \"none\";\nvar HEIGHT = \"height\";\nvar WIDTH = \"width\";\n\nvar parseHorizontalAlignment = _enumParser([LEFT, CENTER, RIGHT]);\n\nvar parseVerticalAlignment = _enumParser([TOP, BOTTOM]);\n\nvar parseOrientation = _enumParser([VERTICAL, HORIZONTAL]);\n\nvar parseItemTextPosition = _enumParser([LEFT, RIGHT, TOP, BOTTOM]);\n\nvar parsePosition = _enumParser([OUTSIDE, INSIDE]);\n\nvar parseItemsAlignment = _enumParser([LEFT, CENTER, RIGHT]);\n\nfunction getState(state, color, stateName) {\n  if (!state) {\n    return;\n  }\n\n  var colorFromAction = state.fill;\n  return (0, _extend2.extend)({}, {\n    state: stateName,\n    fill: colorFromAction === NONE ? color : colorFromAction,\n    opacity: state.opacity,\n    hatching: _extend({}, state.hatching, {\n      step: DEFAULT_MARKER_HATCHING_STEP,\n      width: DEFAULT_MARKER_HATCHING_WIDTH\n    })\n  });\n}\n\nfunction getAttributes(item, state, size) {\n  var attrs = (0, _renderer.processHatchingAttrs)(item, state);\n\n  if (attrs.fill && 0 === attrs.fill.indexOf(\"DevExpress\")) {\n    attrs.fill = (0, _renderer.getFuncIri)(attrs.fill);\n  }\n\n  attrs.opacity = attrs.opacity >= 0 ? attrs.opacity : 1;\n  return (0, _extend2.extend)({}, attrs, {\n    size: size\n  });\n}\n\nfunction parseMargins(options) {\n  var margin = options.margin;\n\n  if (margin >= 0) {\n    margin = _Number(options.margin);\n    margin = {\n      top: margin,\n      bottom: margin,\n      left: margin,\n      right: margin\n    };\n  } else {\n    margin = {\n      top: margin.top >= 0 ? _Number(margin.top) : DEFAULT_MARGIN,\n      bottom: margin.bottom >= 0 ? _Number(margin.bottom) : DEFAULT_MARGIN,\n      left: margin.left >= 0 ? _Number(margin.left) : DEFAULT_MARGIN,\n      right: margin.right >= 0 ? _Number(margin.right) : DEFAULT_MARGIN\n    };\n  }\n\n  options.margin = margin;\n}\n\nfunction getSizeItem(options, markerBBox, labelBBox) {\n  var defaultXMargin = 7;\n  var defaultTopMargin = 4;\n  var width;\n  var height;\n\n  switch (options.itemTextPosition) {\n    case LEFT:\n    case RIGHT:\n      width = markerBBox.width + defaultXMargin + labelBBox.width;\n      height = _max(markerBBox.height, labelBBox.height);\n      break;\n\n    case TOP:\n    case BOTTOM:\n      width = _max(markerBBox.width, labelBBox.width);\n      height = markerBBox.height + defaultTopMargin + labelBBox.height;\n  }\n\n  return {\n    width: width,\n    height: height\n  };\n}\n\nfunction calculateBBoxLabelAndMarker(markerBBox, labelBBox) {\n  var bBox = {};\n  bBox.left = _min(markerBBox.x, labelBBox.x);\n  bBox.top = _min(markerBBox.y, labelBBox.y);\n  bBox.right = _max(markerBBox.x + markerBBox.width, labelBBox.x + labelBBox.width);\n  bBox.bottom = _max(markerBBox.y + markerBBox.height, labelBBox.y + labelBBox.height);\n  return bBox;\n}\n\nfunction applyMarkerState(id, idToIndexMap, items, stateName) {\n  var item = idToIndexMap && items[idToIndexMap[id]];\n\n  if (item) {\n    item.renderMarker(item.states[stateName]);\n  }\n}\n\nfunction parseOptions(options, textField, allowInsidePosition) {\n  if (!options) {\n    return null;\n  }\n\n  parseMargins(options);\n  options.horizontalAlignment = parseHorizontalAlignment(options.horizontalAlignment, RIGHT);\n  options.verticalAlignment = parseVerticalAlignment(options.verticalAlignment, options.horizontalAlignment === CENTER ? BOTTOM : TOP);\n  options.orientation = parseOrientation(options.orientation, options.horizontalAlignment === CENTER ? HORIZONTAL : VERTICAL);\n  options.itemTextPosition = parseItemTextPosition(options.itemTextPosition, options.orientation === HORIZONTAL ? BOTTOM : RIGHT);\n  options.position = allowInsidePosition ? parsePosition(options.position, OUTSIDE) : OUTSIDE;\n  options.itemsAlignment = parseItemsAlignment(options.itemsAlignment, null);\n  options.hoverMode = _normalizeEnum(options.hoverMode);\n  options.customizeText = _isFunction(options.customizeText) ? options.customizeText : function () {\n    return this[textField];\n  };\n  options.customizeHint = _isFunction(options.customizeHint) ? options.customizeHint : _common.noop;\n  options._incidentOccurred = options._incidentOccurred || _common.noop;\n  return options;\n}\n\nfunction createSquareMarker(renderer, size) {\n  return renderer.rect(0, 0, size, size);\n}\n\nfunction createCircleMarker(renderer, size) {\n  return renderer.circle(size / 2, size / 2, size / 2);\n}\n\nfunction isCircle(type) {\n  return \"circle\" === _normalizeEnum(type);\n}\n\nfunction inRect(rect, x, y) {\n  return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n}\n\nfunction checkLinesSize(lines, layoutOptions, countItems, margins) {\n  var position = {\n    x: 0,\n    y: 0\n  };\n  var maxMeasureLength = 0;\n  var maxAltMeasureLength = 0;\n  var margin = 0;\n\n  if (\"y\" === layoutOptions.direction) {\n    margin = margins.top + margins.bottom;\n  } else {\n    margin = margins.left + margins.right;\n  }\n\n  lines.forEach(function (line, i) {\n    var firstItem = line[0];\n    var lineLength = line.length;\n    line.forEach(function (item, index) {\n      var offset = item.offset || layoutOptions.spacing;\n      position[layoutOptions.direction] += item[layoutOptions.measure] + (index !== lineLength - 1 ? offset : 0);\n      maxMeasureLength = _max(maxMeasureLength, position[layoutOptions.direction]);\n    });\n    position[layoutOptions.direction] = 0;\n    position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + firstItem.altOffset || layoutOptions.altSpacing;\n    maxAltMeasureLength = _max(maxAltMeasureLength, position[layoutOptions.altDirection]);\n  });\n\n  if (maxMeasureLength + margin > layoutOptions.length) {\n    layoutOptions.countItem = decreaseItemCount(layoutOptions, countItems);\n    return true;\n  }\n}\n\nfunction decreaseItemCount(layoutOptions, countItems) {\n  layoutOptions.altCountItem++;\n  return _ceil(countItems / layoutOptions.altCountItem);\n}\n\nfunction getLineLength(line, layoutOptions) {\n  return line.reduce(function (lineLength, item) {\n    var offset = item.offset || layoutOptions.spacing;\n    return lineLength + item[layoutOptions.measure] + offset;\n  }, 0);\n}\n\nfunction getMaxLineLength(lines, layoutOptions) {\n  return lines.reduce(function (maxLineLength, line) {\n    return _max(maxLineLength, getLineLength(line, layoutOptions));\n  }, 0);\n}\n\nfunction getInitPositionForDirection(line, layoutOptions, maxLineLength) {\n  var lineLength = getLineLength(line, layoutOptions);\n  var initPosition;\n\n  switch (layoutOptions.itemsAlignment) {\n    case RIGHT:\n      initPosition = maxLineLength - lineLength;\n      break;\n\n    case CENTER:\n      initPosition = (maxLineLength - lineLength) / 2;\n      break;\n\n    default:\n      initPosition = 0;\n  }\n\n  return initPosition;\n}\n\nfunction getPos(layoutOptions) {\n  switch (layoutOptions.itemTextPosition) {\n    case BOTTOM:\n      return {\n        horizontal: CENTER,\n        vertical: TOP\n      };\n\n    case TOP:\n      return {\n        horizontal: CENTER,\n        vertical: BOTTOM\n      };\n\n    case LEFT:\n      return {\n        horizontal: RIGHT,\n        vertical: CENTER\n      };\n\n    case RIGHT:\n      return {\n        horizontal: LEFT,\n        vertical: CENTER\n      };\n  }\n}\n\nfunction getLines(lines, layoutOptions, itemIndex) {\n  var tableLine = {};\n\n  if (itemIndex % layoutOptions.countItem === 0) {\n    if (layoutOptions.markerOffset) {\n      lines.push([], []);\n    } else {\n      lines.push([]);\n    }\n  }\n\n  if (layoutOptions.markerOffset) {\n    tableLine.firstLine = lines[lines.length - 1];\n    tableLine.secondLine = lines[lines.length - 2];\n  } else {\n    tableLine.firstLine = tableLine.secondLine = lines[lines.length - 1];\n  }\n\n  return tableLine;\n}\n\nfunction setMaxInLine(line, measure) {\n  var maxLineSize = line.reduce(function (maxLineSize, item) {\n    var itemMeasure = item ? item[measure] : maxLineSize;\n    return _max(maxLineSize, itemMeasure);\n  }, 0);\n  line.forEach(function (item) {\n    if (item) {\n      item[measure] = maxLineSize;\n    }\n  });\n}\n\nfunction transpose(array) {\n  var width = array.length;\n  var height = array[0].length;\n  var i;\n  var j;\n  var transposeArray = [];\n\n  for (i = 0; i < height; i++) {\n    transposeArray[i] = [];\n\n    for (j = 0; j < width; j++) {\n      transposeArray[i][j] = array[j][i];\n    }\n  }\n\n  return transposeArray;\n}\n\nfunction getAlign(position) {\n  switch (position) {\n    case TOP:\n    case BOTTOM:\n      return CENTER;\n\n    case LEFT:\n      return RIGHT;\n\n    case RIGHT:\n      return LEFT;\n  }\n}\n\nvar getMarkerCreator = function getMarkerCreator(type) {\n  return isCircle(type) ? createCircleMarker : createSquareMarker;\n};\n\nfunction getTitleHorizontalAlignment(options) {\n  if (options.horizontalAlignment === CENTER) {\n    return CENTER;\n  } else {\n    if (options.itemTextPosition === RIGHT) {\n      return LEFT;\n    } else {\n      if (options.itemTextPosition === LEFT) {\n        return RIGHT;\n      } else {\n        return CENTER;\n      }\n    }\n  }\n}\n\nvar Legend = function Legend(settings) {\n  var that = this;\n  that._renderer = settings.renderer;\n  that._legendGroup = settings.group;\n  that._backgroundClass = settings.backgroundClass;\n  that._itemGroupClass = settings.itemGroupClass;\n  that._textField = settings.textField;\n  that._getCustomizeObject = settings.getFormatObject;\n  that._titleGroupClass = settings.titleGroupClass;\n  that._allowInsidePosition = settings.allowInsidePosition;\n  that._widget = settings.widget;\n  that._updated = false;\n};\n\nexports.Legend = Legend;\nvar _Legend = Legend;\nvar legendPrototype = _Legend.prototype = (0, _object.clone)(_layout_element.LayoutElement.prototype);\n(0, _extend2.extend)(legendPrototype, {\n  constructor: _Legend,\n  getOptions: function getOptions() {\n    return this._options;\n  },\n  update: function update() {\n    var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n    var options = arguments.length > 1 ? arguments[1] : void 0;\n    var themeManagerTitleOptions = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n    var that = this;\n    options = that._options = parseOptions(options, that._textField, that._allowInsidePosition) || {};\n    var initMarkerSize = options.markerSize;\n    this._updated = true;\n    this._data = data.map(function (dataItem) {\n      dataItem.size = _Number(dataItem.size > 0 ? dataItem.size : initMarkerSize);\n      dataItem.marker = getAttributes(dataItem, dataItem.states.normal);\n      Object.defineProperty(dataItem.marker, \"size\", {\n        get: function get() {\n          return dataItem.size;\n        },\n        set: function set(value) {\n          dataItem.size = value;\n        }\n      });\n      Object.defineProperty(dataItem.marker, \"opacity\", {\n        get: function get() {\n          return dataItem.states.normal.opacity;\n        },\n        set: function set(value) {\n          dataItem.states.normal.opacity = dataItem.states.hover.opacity = dataItem.states.selection.opacity = value;\n        }\n      });\n      return dataItem;\n    });\n\n    if (options.customizeItems) {\n      that._data = options.customizeItems(data.slice()) || data;\n    }\n\n    that._boundingRect = {\n      width: 0,\n      height: 0,\n      x: 0,\n      y: 0\n    };\n\n    if (that.isVisible() && !that._title) {\n      that._title = new _title.Title({\n        renderer: that._renderer,\n        cssClass: that._titleGroupClass,\n        root: that._legendGroup\n      });\n    }\n\n    if (that._title) {\n      var titleOptions = options.title;\n      themeManagerTitleOptions.horizontalAlignment = getTitleHorizontalAlignment(options);\n\n      that._title.update(themeManagerTitleOptions, titleOptions);\n    }\n\n    this.erase();\n    return that;\n  },\n  isVisible: function isVisible() {\n    return this._options && this._options.visible;\n  },\n  draw: function draw(width, height) {\n    var that = this;\n\n    var items = that._getItemData();\n\n    that.erase();\n\n    if (!(that.isVisible() && items && items.length)) {\n      return that;\n    }\n\n    that._insideLegendGroup = that._renderer.g().enableLinks().append(that._legendGroup);\n\n    that._title.changeLink(that._insideLegendGroup);\n\n    that._createBackground();\n\n    if (that._title.hasText()) {\n      var horizontalPadding = that._background ? 2 * that._options.paddingLeftRight : 0;\n\n      that._title.draw(width - horizontalPadding, height);\n    }\n\n    that._markersGroup = that._renderer.g().attr({\n      \"class\": that._itemGroupClass\n    }).append(that._insideLegendGroup);\n\n    that._createItems(items);\n\n    that._updateElementsPosition(width, height);\n\n    return that;\n  },\n  _measureElements: function _measureElements() {\n    var options = this._options;\n    var maxBBoxHeight = 0;\n\n    this._items.forEach(function (item) {\n      var labelBBox = item.label.getBBox();\n      var markerBBox = item.marker.getBBox();\n      item.markerBBox = markerBBox;\n      item.markerSize = Math.max(markerBBox.width, markerBBox.height);\n      var bBox = getSizeItem(options, markerBBox, labelBBox);\n      item.labelBBox = labelBBox;\n      item.bBox = bBox;\n      maxBBoxHeight = _max(maxBBoxHeight, bBox.height);\n    });\n\n    if (options.equalRowHeight) {\n      this._items.forEach(function (item) {\n        return item.bBox.height = maxBBoxHeight;\n      });\n    }\n  },\n  _updateElementsPosition: function _updateElementsPosition(width, height) {\n    var that = this;\n    var options = that._options;\n    this._size = {\n      width: width,\n      height: height\n    };\n\n    that._measureElements();\n\n    that._locateElements(options);\n\n    that._finalUpdate(options);\n\n    var size = that.getLayoutOptions();\n\n    if (size.width > width || size.height > height) {\n      that.freeSpace();\n    }\n  },\n  _createItems: function _createItems(items) {\n    var that = this;\n    var options = that._options;\n    var renderer = that._renderer;\n    var createMarker = getMarkerCreator(options.markerShape);\n    that._markersId = {};\n    var templateFunction = !options.markerTemplate ? function (dataItem, group) {\n      var attrs = dataItem.marker;\n      createMarker(renderer, attrs.size).attr({\n        fill: attrs.fill,\n        opacity: attrs.opacity\n      }).append({\n        element: group\n      });\n    } : options.markerTemplate;\n\n    var template = that._widget._getTemplate(templateFunction);\n\n    var markersGroup = that._markersGroup;\n    markersGroup.css((0, _utils.patchFontOptions)(options.font));\n    that._deferredItems = [];\n    that._templatesGroups = [];\n    that._items = (items || []).map(function (dataItem, i) {\n      var stateOfDataItem = dataItem.states;\n      var normalState = stateOfDataItem.normal;\n      var normalStateFill = normalState.fill;\n      dataItem.size = dataItem.marker.size;\n      var states = {\n        normal: (0, _extend2.extend)(normalState, {\n          fill: normalStateFill || options.markerColor || options.defaultColor,\n          state: \"normal\"\n        }),\n        hover: getState(stateOfDataItem.hover, normalStateFill, \"hovered\"),\n        selection: getState(stateOfDataItem.selection, normalStateFill, \"selected\")\n      };\n      dataItem.states = states;\n      var itemGroup = renderer.g().append(markersGroup);\n      var markerGroup = renderer.g().attr({\n        \"class\": \"dxl-marker\"\n      }).append(itemGroup);\n      that._deferredItems[i] = new _deferred.Deferred();\n\n      that._templatesGroups.push(markerGroup);\n\n      var item = {\n        label: that._createLabel(dataItem, itemGroup),\n        marker: markerGroup,\n        renderer: renderer,\n        group: itemGroup,\n        tracker: {\n          id: dataItem.id,\n          argument: dataItem.argument,\n          argumentIndex: dataItem.argumentIndex\n        },\n        states: states,\n        itemTextPosition: options.itemTextPosition,\n        markerOffset: 0,\n        bBoxes: [],\n        renderMarker: function renderMarker(state) {\n          dataItem.marker = getAttributes(item, state, dataItem.size);\n          markerGroup.clear();\n          template.render({\n            model: dataItem,\n            container: markerGroup.element,\n            onRendered: that._deferredItems[i].resolve\n          });\n        }\n      };\n      item.renderMarker(states.normal);\n\n      that._createHint(dataItem, itemGroup);\n\n      if (void 0 !== dataItem.id) {\n        that._markersId[dataItem.id] = i;\n      }\n\n      return item;\n    });\n  },\n  getTemplatesGroups: function getTemplatesGroups() {\n    return this._templatesGroups || [];\n  },\n  getTemplatesDef: function getTemplatesDef() {\n    return this._deferredItems || [];\n  },\n  _getItemData: function _getItemData() {\n    var items = this._data || [];\n    var options = this._options || {};\n\n    if (options.inverted) {\n      items = items.slice().reverse();\n    }\n\n    return items.filter(function (i) {\n      return i.visible;\n    });\n  },\n  _finalUpdate: function _finalUpdate(options) {\n    this._adjustBackgroundSettings(options);\n\n    this._setBoundingRect(options.margin);\n  },\n  erase: function erase() {\n    var that = this;\n    var insideLegendGroup = that._insideLegendGroup;\n    insideLegendGroup && insideLegendGroup.dispose();\n    that._insideLegendGroup = that._markersGroup = that._x1 = that._x2 = that._y2 = that._y2 = null;\n    return that;\n  },\n  _locateElements: function _locateElements(locationOptions) {\n    this._moveInInitialValues();\n\n    this._locateRowsColumns(locationOptions);\n  },\n  _moveInInitialValues: function _moveInInitialValues() {\n    var that = this;\n    that._title.hasText() && that._title.move([0, 0]);\n    that._legendGroup && that._legendGroup.move(0, 0);\n    that._background && that._background.attr({\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n  },\n  applySelected: function applySelected(id) {\n    applyMarkerState(id, this._markersId, this._items, \"selection\");\n    return this;\n  },\n  applyHover: function applyHover(id) {\n    applyMarkerState(id, this._markersId, this._items, \"hover\");\n    return this;\n  },\n  resetItem: function resetItem(id) {\n    applyMarkerState(id, this._markersId, this._items, \"normal\");\n    return this;\n  },\n  _createLabel: function _createLabel(data, group) {\n    var labelFormatObject = this._getCustomizeObject(data);\n\n    var options = this._options;\n    var align = getAlign(options.itemTextPosition);\n    var text = options.customizeText.call(labelFormatObject, labelFormatObject);\n    var fontStyle = _isDefined(data.textOpacity) ? {\n      color: options.font.color,\n      opacity: data.textOpacity\n    } : {};\n    return this._renderer.text(text, 0, 0).css((0, _utils.patchFontOptions)(fontStyle)).attr({\n      align: align,\n      \"class\": options.cssClass\n    }).append(group);\n  },\n  _createHint: function _createHint(data, group) {\n    var labelFormatObject = this._getCustomizeObject(data);\n\n    var text = this._options.customizeHint.call(labelFormatObject, labelFormatObject);\n\n    if (_isDefined(text) && \"\" !== text) {\n      group.setTitle(text);\n    }\n  },\n  _createBackground: function _createBackground() {\n    var that = this;\n    var isInside = that._options.position === INSIDE;\n    var color = that._options.backgroundColor;\n    var fill = color || (isInside ? that._options.containerBackgroundColor : NONE);\n\n    if (that._options.border.visible || (isInside || color) && color !== NONE) {\n      that._background = that._renderer.rect(0, 0, 0, 0).attr({\n        fill: fill,\n        \"class\": that._backgroundClass\n      }).append(that._insideLegendGroup);\n    }\n  },\n  _locateRowsColumns: function _locateRowsColumns(options) {\n    var that = this;\n    var iteration = 0;\n\n    var layoutOptions = that._getItemsLayoutOptions();\n\n    var countItems = that._items.length;\n    var lines;\n\n    do {\n      lines = [];\n\n      that._createLines(lines, layoutOptions);\n\n      that._alignLines(lines, layoutOptions);\n\n      iteration++;\n    } while (checkLinesSize(lines, layoutOptions, countItems, options.margin) && iteration < countItems);\n\n    that._applyItemPosition(lines, layoutOptions);\n  },\n  _createLines: function _createLines(lines, layoutOptions) {\n    this._items.forEach(function (item, i) {\n      var tableLine = getLines(lines, layoutOptions, i);\n      var labelBox = {\n        width: item.labelBBox.width,\n        height: item.labelBBox.height,\n        element: item.label,\n        bBox: item.labelBBox,\n        pos: getPos(layoutOptions),\n        itemIndex: i\n      };\n      var markerBox = {\n        width: item.markerBBox.width,\n        height: item.markerBBox.height,\n        element: item.marker,\n        pos: {\n          horizontal: CENTER,\n          vertical: CENTER\n        },\n        bBox: {\n          width: item.markerBBox.width,\n          height: item.markerBBox.height,\n          x: item.markerBBox.x,\n          y: item.markerBBox.y\n        },\n        itemIndex: i\n      };\n      var firstItem;\n      var secondItem;\n      var offsetDirection = layoutOptions.markerOffset ? \"altOffset\" : \"offset\";\n\n      if (layoutOptions.inverseLabelPosition) {\n        firstItem = labelBox;\n        secondItem = markerBox;\n      } else {\n        firstItem = markerBox;\n        secondItem = labelBox;\n      }\n\n      firstItem[offsetDirection] = layoutOptions.labelOffset;\n      tableLine.secondLine.push(firstItem);\n      tableLine.firstLine.push(secondItem);\n    });\n  },\n  _alignLines: function _alignLines(lines, layoutOptions) {\n    var i;\n    var measure = layoutOptions.altMeasure;\n    lines.forEach(function (line) {\n      return setMaxInLine(line, measure);\n    });\n    measure = layoutOptions.measure;\n\n    if (layoutOptions.itemsAlignment) {\n      if (layoutOptions.markerOffset) {\n        for (i = 0; i < lines.length;) {\n          transpose([lines[i++], lines[i++]]).forEach(processLine);\n        }\n      }\n    } else {\n      transpose(lines).forEach(processLine);\n    }\n\n    function processLine(line) {\n      setMaxInLine(line, measure);\n    }\n  },\n  _applyItemPosition: function _applyItemPosition(lines, layoutOptions) {\n    var that = this;\n    var position = {\n      x: 0,\n      y: 0\n    };\n    var maxLineLength = getMaxLineLength(lines, layoutOptions);\n    lines.forEach(function (line) {\n      var firstItem = line[0];\n      var altOffset = firstItem.altOffset || layoutOptions.altSpacing;\n      position[layoutOptions.direction] = getInitPositionForDirection(line, layoutOptions, maxLineLength);\n      line.forEach(function (item) {\n        var offset = item.offset || layoutOptions.spacing;\n        var wrap = new _layout_element.WrapperLayoutElement(item.element, item.bBox);\n        var itemBBoxOptions = {\n          x: position.x,\n          y: position.y,\n          width: item.width,\n          height: item.height\n        };\n        var itemBBox = new _layout_element.WrapperLayoutElement(null, itemBBoxOptions);\n        var itemLegend = that._items[item.itemIndex];\n        wrap.position({\n          of: itemBBox,\n          my: item.pos,\n          at: item.pos\n        });\n        itemLegend.bBoxes.push(itemBBox);\n        position[layoutOptions.direction] += item[layoutOptions.measure] + offset;\n      });\n      position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + altOffset;\n    });\n\n    this._items.forEach(function (item) {\n      var itemBBox = calculateBBoxLabelAndMarker(item.bBoxes[0].getLayoutOptions(), item.bBoxes[1].getLayoutOptions());\n      var horizontal = that._options.columnItemSpacing / 2;\n      var vertical = that._options.rowItemSpacing / 2;\n      item.tracker.left = itemBBox.left - horizontal;\n      item.tracker.right = itemBBox.right + horizontal;\n      item.tracker.top = itemBBox.top - vertical;\n      item.tracker.bottom = itemBBox.bottom + vertical;\n    });\n  },\n  _getItemsLayoutOptions: function _getItemsLayoutOptions() {\n    var that = this;\n    var options = that._options;\n    var orientation = options.orientation;\n    var layoutOptions = {\n      itemsAlignment: options.itemsAlignment,\n      orientation: options.orientation\n    };\n    var width = that._size.width - (that._background ? 2 * options.paddingLeftRight : 0);\n    var height = that._size.height - (that._background ? 2 * options.paddingTopBottom : 0);\n\n    if (orientation === HORIZONTAL) {\n      layoutOptions.length = width;\n      layoutOptions.spacing = options.columnItemSpacing;\n      layoutOptions.direction = \"x\";\n      layoutOptions.measure = WIDTH;\n      layoutOptions.altMeasure = HEIGHT;\n      layoutOptions.altDirection = \"y\";\n      layoutOptions.altSpacing = options.rowItemSpacing;\n      layoutOptions.countItem = options.columnCount;\n      layoutOptions.altCountItem = options.rowCount;\n      layoutOptions.marginTextLabel = 4;\n      layoutOptions.labelOffset = 7;\n\n      if (options.itemTextPosition === BOTTOM || options.itemTextPosition === TOP) {\n        layoutOptions.labelOffset = 4;\n        layoutOptions.markerOffset = true;\n      }\n    } else {\n      layoutOptions.length = height;\n      layoutOptions.spacing = options.rowItemSpacing;\n      layoutOptions.direction = \"y\";\n      layoutOptions.measure = HEIGHT;\n      layoutOptions.altMeasure = WIDTH;\n      layoutOptions.altDirection = \"x\";\n      layoutOptions.altSpacing = options.columnItemSpacing;\n      layoutOptions.countItem = options.rowCount;\n      layoutOptions.altCountItem = options.columnCount;\n      layoutOptions.marginTextLabel = 7;\n      layoutOptions.labelOffset = 4;\n\n      if (options.itemTextPosition === RIGHT || options.itemTextPosition === LEFT) {\n        layoutOptions.labelOffset = 7;\n        layoutOptions.markerOffset = true;\n      }\n    }\n\n    if (!layoutOptions.countItem) {\n      if (layoutOptions.altCountItem) {\n        layoutOptions.countItem = _ceil(that._items.length / layoutOptions.altCountItem);\n      } else {\n        layoutOptions.countItem = that._items.length;\n      }\n    }\n\n    if (options.itemTextPosition === TOP || options.itemTextPosition === LEFT) {\n      layoutOptions.inverseLabelPosition = true;\n    }\n\n    layoutOptions.itemTextPosition = options.itemTextPosition;\n    layoutOptions.altCountItem = layoutOptions.altCountItem || _ceil(that._items.length / layoutOptions.countItem);\n    return layoutOptions;\n  },\n  _adjustBackgroundSettings: function _adjustBackgroundSettings(locationOptions) {\n    if (!this._background) {\n      return;\n    }\n\n    var border = locationOptions.border;\n\n    var legendBox = this._calculateTotalBox();\n\n    var backgroundSettings = {\n      x: _round(legendBox.x - locationOptions.paddingLeftRight),\n      y: _round(legendBox.y - locationOptions.paddingTopBottom),\n      width: _round(legendBox.width) + 2 * locationOptions.paddingLeftRight,\n      height: _round(legendBox.height),\n      opacity: locationOptions.backgroundOpacity\n    };\n\n    if (border.visible && border.width && border.color && border.color !== NONE) {\n      backgroundSettings[\"stroke-width\"] = border.width;\n      backgroundSettings.stroke = border.color;\n      backgroundSettings[\"stroke-opacity\"] = border.opacity;\n      backgroundSettings.dashStyle = border.dashStyle;\n      backgroundSettings.rx = border.cornerRadius || 0;\n      backgroundSettings.ry = border.cornerRadius || 0;\n    }\n\n    this._background.attr(backgroundSettings);\n  },\n  _setBoundingRect: function _setBoundingRect(margin) {\n    if (!this._insideLegendGroup) {\n      return;\n    }\n\n    var box = this._calculateTotalBox();\n\n    box.height += margin.top + margin.bottom;\n    box.widthWithoutMargins = box.width;\n    box.width += margin.left + margin.right;\n    box.x -= margin.left;\n    box.y -= margin.top;\n    this._boundingRect = box;\n  },\n  _calculateTotalBox: function _calculateTotalBox() {\n    var markerBox = this._markersGroup.getBBox();\n\n    var titleBox = this._title.getCorrectedLayoutOptions();\n\n    var box = this._insideLegendGroup.getBBox();\n\n    var verticalPadding = this._background ? 2 * this._options.paddingTopBottom : 0;\n    box.height = markerBox.height + titleBox.height + verticalPadding;\n    titleBox.width > box.width && (box.width = titleBox.width);\n    return box;\n  },\n  getActionCallback: function getActionCallback(point) {\n    var that = this;\n\n    if (that._options.visible) {\n      return function (act) {\n        that[act](point.index);\n      };\n    } else {\n      return _common.noop;\n    }\n  },\n  getLayoutOptions: function getLayoutOptions() {\n    var options = this._options;\n    var boundingRect = this._insideLegendGroup ? this._boundingRect : {\n      width: 0,\n      height: 0,\n      x: 0,\n      y: 0\n    };\n\n    if (options) {\n      boundingRect.verticalAlignment = options.verticalAlignment;\n      boundingRect.horizontalAlignment = options.horizontalAlignment;\n\n      if (options.orientation === HORIZONTAL) {\n        boundingRect.cutLayoutSide = options.verticalAlignment;\n        boundingRect.cutSide = \"vertical\";\n      } else {\n        if (options.horizontalAlignment === CENTER) {\n          boundingRect.cutLayoutSide = options.verticalAlignment;\n          boundingRect.cutSide = \"vertical\";\n        } else {\n          boundingRect.cutLayoutSide = options.horizontalAlignment;\n          boundingRect.cutSide = \"horizontal\";\n        }\n      }\n\n      boundingRect.position = {\n        horizontal: options.horizontalAlignment,\n        vertical: options.verticalAlignment\n      };\n      return boundingRect;\n    }\n\n    return null;\n  },\n  shift: function shift(x, y) {\n    var that = this;\n    var box = {};\n\n    if (that._insideLegendGroup) {\n      that._insideLegendGroup.attr({\n        translateX: x - that._boundingRect.x,\n        translateY: y - that._boundingRect.y\n      });\n    }\n\n    that._title && that._shiftTitle(that._boundingRect.widthWithoutMargins);\n    that._markersGroup && that._shiftMarkers();\n\n    if (that._insideLegendGroup) {\n      box = that._legendGroup.getBBox();\n    }\n\n    that._x1 = box.x;\n    that._y1 = box.y;\n    that._x2 = box.x + box.width;\n    that._y2 = box.y + box.height;\n    return that;\n  },\n  _shiftTitle: function _shiftTitle(boxWidth) {\n    var that = this;\n    var title = that._title;\n    var titleBox = title.getCorrectedLayoutOptions();\n\n    if (!titleBox || !title.hasText()) {\n      return;\n    }\n\n    var width = boxWidth - (that._background ? 2 * that._options.paddingLeftRight : 0);\n    var titleOptions = title.getOptions();\n    var titleY = titleBox.y + titleOptions.margin.top;\n    var titleX = 0;\n\n    if (titleOptions.verticalAlignment === BOTTOM && that._markersGroup) {\n      titleY += that._markersGroup.getBBox().height;\n    }\n\n    if (titleOptions.horizontalAlignment === RIGHT) {\n      titleX = width - titleBox.width;\n    } else {\n      if (titleOptions.horizontalAlignment === CENTER) {\n        titleX = (width - titleBox.width) / 2;\n      }\n    }\n\n    title.shift(titleX, titleY);\n  },\n  _shiftMarkers: function _shiftMarkers() {\n    var titleBox = this._title.getLayoutOptions();\n\n    var markerBox = this._markersGroup.getBBox();\n\n    var titleOptions = this._title.getOptions() || {};\n    var center = 0;\n    var y = 0;\n\n    if (titleBox.width > markerBox.width && this._options.horizontalAlignment === CENTER) {\n      center = titleBox.width / 2 - markerBox.width / 2;\n    }\n\n    if (titleOptions.verticalAlignment === TOP) {\n      y = titleBox.height;\n    }\n\n    if (0 !== center || 0 !== y) {\n      this._markersGroup.attr({\n        translateX: center,\n        translateY: y\n      });\n\n      this._items.forEach(function (item) {\n        item.tracker.left += center;\n        item.tracker.right += center;\n        item.tracker.top += y;\n        item.tracker.bottom += y;\n      });\n    }\n  },\n  getPosition: function getPosition() {\n    return this._options.position;\n  },\n  coordsIn: function coordsIn(x, y) {\n    return x >= this._x1 && x <= this._x2 && y >= this._y1 && y <= this._y2;\n  },\n  getItemByCoord: function getItemByCoord(x, y) {\n    var items = this._items;\n    var legendGroup = this._insideLegendGroup;\n    x -= legendGroup.attr(\"translateX\");\n    y -= legendGroup.attr(\"translateY\");\n\n    for (var i = 0; i < items.length; i++) {\n      if (inRect(items[i].tracker, x, y)) {\n        return items[i].tracker;\n      }\n    }\n\n    return null;\n  },\n  dispose: function dispose() {\n    var that = this;\n    that._title && that._title.dispose();\n    that._legendGroup = that._insideLegendGroup = that._title = that._renderer = that._options = that._data = that._items = null;\n    return that;\n  },\n  layoutOptions: function layoutOptions() {\n    if (!this.isVisible()) {\n      return null;\n    }\n\n    var pos = this.getLayoutOptions();\n    return {\n      horizontalAlignment: this._options.horizontalAlignment,\n      verticalAlignment: this._options.verticalAlignment,\n      side: pos.cutSide,\n      priority: 1,\n      position: this.getPosition()\n    };\n  },\n  measure: function measure(size) {\n    if (this._updated || !this._insideLegendGroup) {\n      this.draw(size[0], size[1]);\n      this._updated = false;\n    } else {\n      this._items.forEach(function (item) {\n        item.bBoxes = [];\n      });\n\n      this._updateElementsPosition(size[0], size[1]);\n    }\n\n    var rect = this.getLayoutOptions();\n    return [rect.width, rect.height];\n  },\n  move: function move(rect) {\n    this.shift(rect[0], rect[1]);\n  },\n  freeSpace: function freeSpace() {\n    this._options._incidentOccurred(\"W2104\");\n\n    this.erase();\n  }\n});\nvar plugin = {\n  name: \"legend\",\n  init: function init() {\n    var that = this;\n\n    var group = this._renderer.g().attr({\n      \"class\": this._rootClassPrefix + \"-legend\"\n    }).enableLinks().append(that._renderer.root);\n\n    that._legend = new Legend({\n      renderer: that._renderer,\n      group: group,\n      widget: this,\n      itemGroupClass: this._rootClassPrefix + \"-item\",\n      titleGroupClass: this._rootClassPrefix + \"-title\",\n      textField: \"text\",\n      getFormatObject: function getFormatObject(data) {\n        return {\n          item: data.item,\n          text: data.text\n        };\n      }\n    });\n\n    that._layout.add(that._legend);\n  },\n  extenders: {\n    _applyTilesAppearance: function _applyTilesAppearance() {\n      var that = this;\n\n      this._items.forEach(function (item) {\n        that._applyLegendItemStyle(item.id, item.getState());\n      });\n    },\n    _buildNodes: function _buildNodes() {\n      this._createLegendItems();\n    }\n  },\n  members: {\n    _applyLegendItemStyle: function _applyLegendItemStyle(id, state) {\n      var legend = this._legend;\n\n      switch (state) {\n        case \"hover\":\n          legend.applyHover(id);\n          break;\n\n        case \"selection\":\n          legend.applySelected(id);\n          break;\n\n        default:\n          legend.resetItem(id);\n      }\n    },\n    _createLegendItems: function _createLegendItems() {\n      if (this._legend.update(this._getLegendData(), this._getOption(\"legend\"), this._themeManager.theme(\"legend\").title)) {\n        this._requestChange([\"LAYOUT\"]);\n      }\n    }\n  },\n  dispose: function dispose() {\n    this._legend.dispose();\n  },\n  customize: function customize(constructor) {\n    constructor.prototype._proxyData.push(function (x, y) {\n      if (this._legend.coordsIn(x, y)) {\n        var item = this._legend.getItemByCoord(x, y);\n\n        if (item) {\n          return {\n            id: item.id,\n            type: \"legend\"\n          };\n        }\n      }\n    });\n\n    constructor.addChange({\n      code: \"LEGEND\",\n      handler: function handler() {\n        this._createLegendItems();\n      },\n      isThemeDependent: true,\n      option: \"legend\",\n      isOptionChange: true\n    });\n  }\n};\nexports.plugin = plugin;","map":{"version":3,"sources":["E:/Monday.com/quickstart-react/node_modules/devextreme/viz/components/legend.js"],"names":["exports","plugin","Legend","_utils","require","_extend2","_layout_element","_type","_title","_object","_common","_renderer","_deferred","_Number","Number","_math","Math","_round","round","_max","max","_min","min","_ceil","ceil","_isDefined","isDefined","_isFunction","isFunction","_enumParser","enumParser","_normalizeEnum","normalizeEnum","_extend","extend","DEFAULT_MARGIN","DEFAULT_MARKER_HATCHING_WIDTH","DEFAULT_MARKER_HATCHING_STEP","CENTER","RIGHT","LEFT","TOP","BOTTOM","HORIZONTAL","VERTICAL","INSIDE","OUTSIDE","NONE","HEIGHT","WIDTH","parseHorizontalAlignment","parseVerticalAlignment","parseOrientation","parseItemTextPosition","parsePosition","parseItemsAlignment","getState","state","color","stateName","colorFromAction","fill","opacity","hatching","step","width","getAttributes","item","size","attrs","processHatchingAttrs","indexOf","getFuncIri","parseMargins","options","margin","top","bottom","left","right","getSizeItem","markerBBox","labelBBox","defaultXMargin","defaultTopMargin","height","itemTextPosition","calculateBBoxLabelAndMarker","bBox","x","y","applyMarkerState","id","idToIndexMap","items","renderMarker","states","parseOptions","textField","allowInsidePosition","horizontalAlignment","verticalAlignment","orientation","position","itemsAlignment","hoverMode","customizeText","customizeHint","noop","_incidentOccurred","createSquareMarker","renderer","rect","createCircleMarker","circle","isCircle","type","inRect","checkLinesSize","lines","layoutOptions","countItems","margins","maxMeasureLength","maxAltMeasureLength","direction","forEach","line","i","firstItem","lineLength","length","index","offset","spacing","measure","altDirection","altMeasure","altOffset","altSpacing","countItem","decreaseItemCount","altCountItem","getLineLength","reduce","getMaxLineLength","maxLineLength","getInitPositionForDirection","initPosition","getPos","horizontal","vertical","getLines","itemIndex","tableLine","markerOffset","push","firstLine","secondLine","setMaxInLine","maxLineSize","itemMeasure","transpose","array","j","transposeArray","getAlign","getMarkerCreator","getTitleHorizontalAlignment","settings","that","_legendGroup","group","_backgroundClass","backgroundClass","_itemGroupClass","itemGroupClass","_textField","_getCustomizeObject","getFormatObject","_titleGroupClass","titleGroupClass","_allowInsidePosition","_widget","widget","_updated","_Legend","legendPrototype","prototype","clone","LayoutElement","constructor","getOptions","_options","update","data","arguments","themeManagerTitleOptions","initMarkerSize","markerSize","_data","map","dataItem","marker","normal","Object","defineProperty","get","set","value","hover","selection","customizeItems","slice","_boundingRect","isVisible","Title","cssClass","root","titleOptions","title","erase","visible","draw","_getItemData","_insideLegendGroup","g","enableLinks","append","changeLink","_createBackground","hasText","horizontalPadding","_background","paddingLeftRight","_markersGroup","attr","_createItems","_updateElementsPosition","_measureElements","maxBBoxHeight","_items","label","getBBox","equalRowHeight","_size","_locateElements","_finalUpdate","getLayoutOptions","freeSpace","createMarker","markerShape","_markersId","templateFunction","markerTemplate","element","template","_getTemplate","markersGroup","css","patchFontOptions","font","_deferredItems","_templatesGroups","stateOfDataItem","normalState","normalStateFill","markerColor","defaultColor","itemGroup","markerGroup","Deferred","_createLabel","tracker","argument","argumentIndex","bBoxes","clear","render","model","container","onRendered","resolve","_createHint","getTemplatesGroups","getTemplatesDef","inverted","reverse","filter","_adjustBackgroundSettings","_setBoundingRect","insideLegendGroup","dispose","_x1","_x2","_y2","locationOptions","_moveInInitialValues","_locateRowsColumns","move","applySelected","applyHover","resetItem","labelFormatObject","align","text","call","fontStyle","textOpacity","setTitle","isInside","backgroundColor","containerBackgroundColor","border","iteration","_getItemsLayoutOptions","_createLines","_alignLines","_applyItemPosition","labelBox","pos","markerBox","secondItem","offsetDirection","inverseLabelPosition","labelOffset","processLine","wrap","WrapperLayoutElement","itemBBoxOptions","itemBBox","itemLegend","of","my","at","columnItemSpacing","rowItemSpacing","paddingTopBottom","columnCount","rowCount","marginTextLabel","legendBox","_calculateTotalBox","backgroundSettings","backgroundOpacity","stroke","dashStyle","rx","cornerRadius","ry","box","widthWithoutMargins","titleBox","getCorrectedLayoutOptions","verticalPadding","getActionCallback","point","act","boundingRect","cutLayoutSide","cutSide","shift","translateX","translateY","_shiftTitle","_shiftMarkers","_y1","boxWidth","titleY","titleX","center","getPosition","coordsIn","getItemByCoord","legendGroup","side","priority","name","init","_rootClassPrefix","_legend","_layout","add","extenders","_applyTilesAppearance","_applyLegendItemStyle","_buildNodes","_createLegendItems","members","legend","_getLegendData","_getOption","_themeManager","theme","_requestChange","customize","_proxyData","addChange","code","handler","isThemeDependent","option","isOptionChange"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (viz/components/legend.js)\r\n * Version: 20.2.3\r\n * Build date: Tue Oct 20 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.plugin = exports.Legend = void 0;\r\nvar _utils = require(\"../core/utils\");\r\nvar _extend2 = require(\"../../core/utils/extend\");\r\nvar _layout_element = require(\"../core/layout_element\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _title = require(\"../core/title\");\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _renderer = require(\"../core/renderers/renderer\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _Number = Number;\r\nvar _math = Math;\r\nvar _round = _math.round;\r\nvar _max = _math.max;\r\nvar _min = _math.min;\r\nvar _ceil = _math.ceil;\r\nvar _isDefined = _type.isDefined;\r\nvar _isFunction = _type.isFunction;\r\nvar _enumParser = _utils.enumParser;\r\nvar _normalizeEnum = _utils.normalizeEnum;\r\nvar _extend = _extend2.extend;\r\nvar DEFAULT_MARGIN = 10;\r\nvar DEFAULT_MARKER_HATCHING_WIDTH = 2;\r\nvar DEFAULT_MARKER_HATCHING_STEP = 5;\r\nvar CENTER = \"center\";\r\nvar RIGHT = \"right\";\r\nvar LEFT = \"left\";\r\nvar TOP = \"top\";\r\nvar BOTTOM = \"bottom\";\r\nvar HORIZONTAL = \"horizontal\";\r\nvar VERTICAL = \"vertical\";\r\nvar INSIDE = \"inside\";\r\nvar OUTSIDE = \"outside\";\r\nvar NONE = \"none\";\r\nvar HEIGHT = \"height\";\r\nvar WIDTH = \"width\";\r\nvar parseHorizontalAlignment = _enumParser([LEFT, CENTER, RIGHT]);\r\nvar parseVerticalAlignment = _enumParser([TOP, BOTTOM]);\r\nvar parseOrientation = _enumParser([VERTICAL, HORIZONTAL]);\r\nvar parseItemTextPosition = _enumParser([LEFT, RIGHT, TOP, BOTTOM]);\r\nvar parsePosition = _enumParser([OUTSIDE, INSIDE]);\r\nvar parseItemsAlignment = _enumParser([LEFT, CENTER, RIGHT]);\r\n\r\nfunction getState(state, color, stateName) {\r\n    if (!state) {\r\n        return\r\n    }\r\n    var colorFromAction = state.fill;\r\n    return (0, _extend2.extend)({}, {\r\n        state: stateName,\r\n        fill: colorFromAction === NONE ? color : colorFromAction,\r\n        opacity: state.opacity,\r\n        hatching: _extend({}, state.hatching, {\r\n            step: DEFAULT_MARKER_HATCHING_STEP,\r\n            width: DEFAULT_MARKER_HATCHING_WIDTH\r\n        })\r\n    })\r\n}\r\n\r\nfunction getAttributes(item, state, size) {\r\n    var attrs = (0, _renderer.processHatchingAttrs)(item, state);\r\n    if (attrs.fill && 0 === attrs.fill.indexOf(\"DevExpress\")) {\r\n        attrs.fill = (0, _renderer.getFuncIri)(attrs.fill)\r\n    }\r\n    attrs.opacity = attrs.opacity >= 0 ? attrs.opacity : 1;\r\n    return (0, _extend2.extend)({}, attrs, {\r\n        size: size\r\n    })\r\n}\r\n\r\nfunction parseMargins(options) {\r\n    var margin = options.margin;\r\n    if (margin >= 0) {\r\n        margin = _Number(options.margin);\r\n        margin = {\r\n            top: margin,\r\n            bottom: margin,\r\n            left: margin,\r\n            right: margin\r\n        }\r\n    } else {\r\n        margin = {\r\n            top: margin.top >= 0 ? _Number(margin.top) : DEFAULT_MARGIN,\r\n            bottom: margin.bottom >= 0 ? _Number(margin.bottom) : DEFAULT_MARGIN,\r\n            left: margin.left >= 0 ? _Number(margin.left) : DEFAULT_MARGIN,\r\n            right: margin.right >= 0 ? _Number(margin.right) : DEFAULT_MARGIN\r\n        }\r\n    }\r\n    options.margin = margin\r\n}\r\n\r\nfunction getSizeItem(options, markerBBox, labelBBox) {\r\n    var defaultXMargin = 7;\r\n    var defaultTopMargin = 4;\r\n    var width;\r\n    var height;\r\n    switch (options.itemTextPosition) {\r\n        case LEFT:\r\n        case RIGHT:\r\n            width = markerBBox.width + defaultXMargin + labelBBox.width;\r\n            height = _max(markerBBox.height, labelBBox.height);\r\n            break;\r\n        case TOP:\r\n        case BOTTOM:\r\n            width = _max(markerBBox.width, labelBBox.width);\r\n            height = markerBBox.height + defaultTopMargin + labelBBox.height\r\n    }\r\n    return {\r\n        width: width,\r\n        height: height\r\n    }\r\n}\r\n\r\nfunction calculateBBoxLabelAndMarker(markerBBox, labelBBox) {\r\n    var bBox = {};\r\n    bBox.left = _min(markerBBox.x, labelBBox.x);\r\n    bBox.top = _min(markerBBox.y, labelBBox.y);\r\n    bBox.right = _max(markerBBox.x + markerBBox.width, labelBBox.x + labelBBox.width);\r\n    bBox.bottom = _max(markerBBox.y + markerBBox.height, labelBBox.y + labelBBox.height);\r\n    return bBox\r\n}\r\n\r\nfunction applyMarkerState(id, idToIndexMap, items, stateName) {\r\n    var item = idToIndexMap && items[idToIndexMap[id]];\r\n    if (item) {\r\n        item.renderMarker(item.states[stateName])\r\n    }\r\n}\r\n\r\nfunction parseOptions(options, textField, allowInsidePosition) {\r\n    if (!options) {\r\n        return null\r\n    }\r\n    parseMargins(options);\r\n    options.horizontalAlignment = parseHorizontalAlignment(options.horizontalAlignment, RIGHT);\r\n    options.verticalAlignment = parseVerticalAlignment(options.verticalAlignment, options.horizontalAlignment === CENTER ? BOTTOM : TOP);\r\n    options.orientation = parseOrientation(options.orientation, options.horizontalAlignment === CENTER ? HORIZONTAL : VERTICAL);\r\n    options.itemTextPosition = parseItemTextPosition(options.itemTextPosition, options.orientation === HORIZONTAL ? BOTTOM : RIGHT);\r\n    options.position = allowInsidePosition ? parsePosition(options.position, OUTSIDE) : OUTSIDE;\r\n    options.itemsAlignment = parseItemsAlignment(options.itemsAlignment, null);\r\n    options.hoverMode = _normalizeEnum(options.hoverMode);\r\n    options.customizeText = _isFunction(options.customizeText) ? options.customizeText : function() {\r\n        return this[textField]\r\n    };\r\n    options.customizeHint = _isFunction(options.customizeHint) ? options.customizeHint : _common.noop;\r\n    options._incidentOccurred = options._incidentOccurred || _common.noop;\r\n    return options\r\n}\r\n\r\nfunction createSquareMarker(renderer, size) {\r\n    return renderer.rect(0, 0, size, size)\r\n}\r\n\r\nfunction createCircleMarker(renderer, size) {\r\n    return renderer.circle(size / 2, size / 2, size / 2)\r\n}\r\n\r\nfunction isCircle(type) {\r\n    return \"circle\" === _normalizeEnum(type)\r\n}\r\n\r\nfunction inRect(rect, x, y) {\r\n    return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom\r\n}\r\n\r\nfunction checkLinesSize(lines, layoutOptions, countItems, margins) {\r\n    var position = {\r\n        x: 0,\r\n        y: 0\r\n    };\r\n    var maxMeasureLength = 0;\r\n    var maxAltMeasureLength = 0;\r\n    var margin = 0;\r\n    if (\"y\" === layoutOptions.direction) {\r\n        margin = margins.top + margins.bottom\r\n    } else {\r\n        margin = margins.left + margins.right\r\n    }\r\n    lines.forEach(function(line, i) {\r\n        var firstItem = line[0];\r\n        var lineLength = line.length;\r\n        line.forEach(function(item, index) {\r\n            var offset = item.offset || layoutOptions.spacing;\r\n            position[layoutOptions.direction] += item[layoutOptions.measure] + (index !== lineLength - 1 ? offset : 0);\r\n            maxMeasureLength = _max(maxMeasureLength, position[layoutOptions.direction])\r\n        });\r\n        position[layoutOptions.direction] = 0;\r\n        position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + firstItem.altOffset || layoutOptions.altSpacing;\r\n        maxAltMeasureLength = _max(maxAltMeasureLength, position[layoutOptions.altDirection])\r\n    });\r\n    if (maxMeasureLength + margin > layoutOptions.length) {\r\n        layoutOptions.countItem = decreaseItemCount(layoutOptions, countItems);\r\n        return true\r\n    }\r\n}\r\n\r\nfunction decreaseItemCount(layoutOptions, countItems) {\r\n    layoutOptions.altCountItem++;\r\n    return _ceil(countItems / layoutOptions.altCountItem)\r\n}\r\n\r\nfunction getLineLength(line, layoutOptions) {\r\n    return line.reduce(function(lineLength, item) {\r\n        var offset = item.offset || layoutOptions.spacing;\r\n        return lineLength + item[layoutOptions.measure] + offset\r\n    }, 0)\r\n}\r\n\r\nfunction getMaxLineLength(lines, layoutOptions) {\r\n    return lines.reduce(function(maxLineLength, line) {\r\n        return _max(maxLineLength, getLineLength(line, layoutOptions))\r\n    }, 0)\r\n}\r\n\r\nfunction getInitPositionForDirection(line, layoutOptions, maxLineLength) {\r\n    var lineLength = getLineLength(line, layoutOptions);\r\n    var initPosition;\r\n    switch (layoutOptions.itemsAlignment) {\r\n        case RIGHT:\r\n            initPosition = maxLineLength - lineLength;\r\n            break;\r\n        case CENTER:\r\n            initPosition = (maxLineLength - lineLength) / 2;\r\n            break;\r\n        default:\r\n            initPosition = 0\r\n    }\r\n    return initPosition\r\n}\r\n\r\nfunction getPos(layoutOptions) {\r\n    switch (layoutOptions.itemTextPosition) {\r\n        case BOTTOM:\r\n            return {\r\n                horizontal: CENTER, vertical: TOP\r\n            };\r\n        case TOP:\r\n            return {\r\n                horizontal: CENTER, vertical: BOTTOM\r\n            };\r\n        case LEFT:\r\n            return {\r\n                horizontal: RIGHT, vertical: CENTER\r\n            };\r\n        case RIGHT:\r\n            return {\r\n                horizontal: LEFT, vertical: CENTER\r\n            }\r\n    }\r\n}\r\n\r\nfunction getLines(lines, layoutOptions, itemIndex) {\r\n    var tableLine = {};\r\n    if (itemIndex % layoutOptions.countItem === 0) {\r\n        if (layoutOptions.markerOffset) {\r\n            lines.push([], [])\r\n        } else {\r\n            lines.push([])\r\n        }\r\n    }\r\n    if (layoutOptions.markerOffset) {\r\n        tableLine.firstLine = lines[lines.length - 1];\r\n        tableLine.secondLine = lines[lines.length - 2]\r\n    } else {\r\n        tableLine.firstLine = tableLine.secondLine = lines[lines.length - 1]\r\n    }\r\n    return tableLine\r\n}\r\n\r\nfunction setMaxInLine(line, measure) {\r\n    var maxLineSize = line.reduce(function(maxLineSize, item) {\r\n        var itemMeasure = item ? item[measure] : maxLineSize;\r\n        return _max(maxLineSize, itemMeasure)\r\n    }, 0);\r\n    line.forEach(function(item) {\r\n        if (item) {\r\n            item[measure] = maxLineSize\r\n        }\r\n    })\r\n}\r\n\r\nfunction transpose(array) {\r\n    var width = array.length;\r\n    var height = array[0].length;\r\n    var i;\r\n    var j;\r\n    var transposeArray = [];\r\n    for (i = 0; i < height; i++) {\r\n        transposeArray[i] = [];\r\n        for (j = 0; j < width; j++) {\r\n            transposeArray[i][j] = array[j][i]\r\n        }\r\n    }\r\n    return transposeArray\r\n}\r\n\r\nfunction getAlign(position) {\r\n    switch (position) {\r\n        case TOP:\r\n        case BOTTOM:\r\n            return CENTER;\r\n        case LEFT:\r\n            return RIGHT;\r\n        case RIGHT:\r\n            return LEFT\r\n    }\r\n}\r\nvar getMarkerCreator = function(type) {\r\n    return isCircle(type) ? createCircleMarker : createSquareMarker\r\n};\r\n\r\nfunction getTitleHorizontalAlignment(options) {\r\n    if (options.horizontalAlignment === CENTER) {\r\n        return CENTER\r\n    } else {\r\n        if (options.itemTextPosition === RIGHT) {\r\n            return LEFT\r\n        } else {\r\n            if (options.itemTextPosition === LEFT) {\r\n                return RIGHT\r\n            } else {\r\n                return CENTER\r\n            }\r\n        }\r\n    }\r\n}\r\nvar Legend = function(settings) {\r\n    var that = this;\r\n    that._renderer = settings.renderer;\r\n    that._legendGroup = settings.group;\r\n    that._backgroundClass = settings.backgroundClass;\r\n    that._itemGroupClass = settings.itemGroupClass;\r\n    that._textField = settings.textField;\r\n    that._getCustomizeObject = settings.getFormatObject;\r\n    that._titleGroupClass = settings.titleGroupClass;\r\n    that._allowInsidePosition = settings.allowInsidePosition;\r\n    that._widget = settings.widget;\r\n    that._updated = false\r\n};\r\nexports.Legend = Legend;\r\nvar _Legend = Legend;\r\nvar legendPrototype = _Legend.prototype = (0, _object.clone)(_layout_element.LayoutElement.prototype);\r\n(0, _extend2.extend)(legendPrototype, {\r\n    constructor: _Legend,\r\n    getOptions: function() {\r\n        return this._options\r\n    },\r\n    update: function() {\r\n        var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n        var options = arguments.length > 1 ? arguments[1] : void 0;\r\n        var themeManagerTitleOptions = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n        var that = this;\r\n        options = that._options = parseOptions(options, that._textField, that._allowInsidePosition) || {};\r\n        var initMarkerSize = options.markerSize;\r\n        this._updated = true;\r\n        this._data = data.map(function(dataItem) {\r\n            dataItem.size = _Number(dataItem.size > 0 ? dataItem.size : initMarkerSize);\r\n            dataItem.marker = getAttributes(dataItem, dataItem.states.normal);\r\n            Object.defineProperty(dataItem.marker, \"size\", {\r\n                get: function() {\r\n                    return dataItem.size\r\n                },\r\n                set: function(value) {\r\n                    dataItem.size = value\r\n                }\r\n            });\r\n            Object.defineProperty(dataItem.marker, \"opacity\", {\r\n                get: function() {\r\n                    return dataItem.states.normal.opacity\r\n                },\r\n                set: function(value) {\r\n                    dataItem.states.normal.opacity = dataItem.states.hover.opacity = dataItem.states.selection.opacity = value\r\n                }\r\n            });\r\n            return dataItem\r\n        });\r\n        if (options.customizeItems) {\r\n            that._data = options.customizeItems(data.slice()) || data\r\n        }\r\n        that._boundingRect = {\r\n            width: 0,\r\n            height: 0,\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        if (that.isVisible() && !that._title) {\r\n            that._title = new _title.Title({\r\n                renderer: that._renderer,\r\n                cssClass: that._titleGroupClass,\r\n                root: that._legendGroup\r\n            })\r\n        }\r\n        if (that._title) {\r\n            var titleOptions = options.title;\r\n            themeManagerTitleOptions.horizontalAlignment = getTitleHorizontalAlignment(options);\r\n            that._title.update(themeManagerTitleOptions, titleOptions)\r\n        }\r\n        this.erase();\r\n        return that\r\n    },\r\n    isVisible: function() {\r\n        return this._options && this._options.visible\r\n    },\r\n    draw: function(width, height) {\r\n        var that = this;\r\n        var items = that._getItemData();\r\n        that.erase();\r\n        if (!(that.isVisible() && items && items.length)) {\r\n            return that\r\n        }\r\n        that._insideLegendGroup = that._renderer.g().enableLinks().append(that._legendGroup);\r\n        that._title.changeLink(that._insideLegendGroup);\r\n        that._createBackground();\r\n        if (that._title.hasText()) {\r\n            var horizontalPadding = that._background ? 2 * that._options.paddingLeftRight : 0;\r\n            that._title.draw(width - horizontalPadding, height)\r\n        }\r\n        that._markersGroup = that._renderer.g().attr({\r\n            \"class\": that._itemGroupClass\r\n        }).append(that._insideLegendGroup);\r\n        that._createItems(items);\r\n        that._updateElementsPosition(width, height);\r\n        return that\r\n    },\r\n    _measureElements: function() {\r\n        var options = this._options;\r\n        var maxBBoxHeight = 0;\r\n        this._items.forEach(function(item) {\r\n            var labelBBox = item.label.getBBox();\r\n            var markerBBox = item.marker.getBBox();\r\n            item.markerBBox = markerBBox;\r\n            item.markerSize = Math.max(markerBBox.width, markerBBox.height);\r\n            var bBox = getSizeItem(options, markerBBox, labelBBox);\r\n            item.labelBBox = labelBBox;\r\n            item.bBox = bBox;\r\n            maxBBoxHeight = _max(maxBBoxHeight, bBox.height)\r\n        });\r\n        if (options.equalRowHeight) {\r\n            this._items.forEach(function(item) {\r\n                return item.bBox.height = maxBBoxHeight\r\n            })\r\n        }\r\n    },\r\n    _updateElementsPosition: function(width, height) {\r\n        var that = this;\r\n        var options = that._options;\r\n        this._size = {\r\n            width: width,\r\n            height: height\r\n        };\r\n        that._measureElements();\r\n        that._locateElements(options);\r\n        that._finalUpdate(options);\r\n        var size = that.getLayoutOptions();\r\n        if (size.width > width || size.height > height) {\r\n            that.freeSpace()\r\n        }\r\n    },\r\n    _createItems: function(items) {\r\n        var that = this;\r\n        var options = that._options;\r\n        var renderer = that._renderer;\r\n        var createMarker = getMarkerCreator(options.markerShape);\r\n        that._markersId = {};\r\n        var templateFunction = !options.markerTemplate ? function(dataItem, group) {\r\n            var attrs = dataItem.marker;\r\n            createMarker(renderer, attrs.size).attr({\r\n                fill: attrs.fill,\r\n                opacity: attrs.opacity\r\n            }).append({\r\n                element: group\r\n            })\r\n        } : options.markerTemplate;\r\n        var template = that._widget._getTemplate(templateFunction);\r\n        var markersGroup = that._markersGroup;\r\n        markersGroup.css((0, _utils.patchFontOptions)(options.font));\r\n        that._deferredItems = [];\r\n        that._templatesGroups = [];\r\n        that._items = (items || []).map(function(dataItem, i) {\r\n            var stateOfDataItem = dataItem.states;\r\n            var normalState = stateOfDataItem.normal;\r\n            var normalStateFill = normalState.fill;\r\n            dataItem.size = dataItem.marker.size;\r\n            var states = {\r\n                normal: (0, _extend2.extend)(normalState, {\r\n                    fill: normalStateFill || options.markerColor || options.defaultColor,\r\n                    state: \"normal\"\r\n                }),\r\n                hover: getState(stateOfDataItem.hover, normalStateFill, \"hovered\"),\r\n                selection: getState(stateOfDataItem.selection, normalStateFill, \"selected\")\r\n            };\r\n            dataItem.states = states;\r\n            var itemGroup = renderer.g().append(markersGroup);\r\n            var markerGroup = renderer.g().attr({\r\n                \"class\": \"dxl-marker\"\r\n            }).append(itemGroup);\r\n            that._deferredItems[i] = new _deferred.Deferred;\r\n            that._templatesGroups.push(markerGroup);\r\n            var item = {\r\n                label: that._createLabel(dataItem, itemGroup),\r\n                marker: markerGroup,\r\n                renderer: renderer,\r\n                group: itemGroup,\r\n                tracker: {\r\n                    id: dataItem.id,\r\n                    argument: dataItem.argument,\r\n                    argumentIndex: dataItem.argumentIndex\r\n                },\r\n                states: states,\r\n                itemTextPosition: options.itemTextPosition,\r\n                markerOffset: 0,\r\n                bBoxes: [],\r\n                renderMarker: function(state) {\r\n                    dataItem.marker = getAttributes(item, state, dataItem.size);\r\n                    markerGroup.clear();\r\n                    template.render({\r\n                        model: dataItem,\r\n                        container: markerGroup.element,\r\n                        onRendered: that._deferredItems[i].resolve\r\n                    })\r\n                }\r\n            };\r\n            item.renderMarker(states.normal);\r\n            that._createHint(dataItem, itemGroup);\r\n            if (void 0 !== dataItem.id) {\r\n                that._markersId[dataItem.id] = i\r\n            }\r\n            return item\r\n        })\r\n    },\r\n    getTemplatesGroups: function() {\r\n        return this._templatesGroups || []\r\n    },\r\n    getTemplatesDef: function() {\r\n        return this._deferredItems || []\r\n    },\r\n    _getItemData: function() {\r\n        var items = this._data || [];\r\n        var options = this._options || {};\r\n        if (options.inverted) {\r\n            items = items.slice().reverse()\r\n        }\r\n        return items.filter(function(i) {\r\n            return i.visible\r\n        })\r\n    },\r\n    _finalUpdate: function(options) {\r\n        this._adjustBackgroundSettings(options);\r\n        this._setBoundingRect(options.margin)\r\n    },\r\n    erase: function() {\r\n        var that = this;\r\n        var insideLegendGroup = that._insideLegendGroup;\r\n        insideLegendGroup && insideLegendGroup.dispose();\r\n        that._insideLegendGroup = that._markersGroup = that._x1 = that._x2 = that._y2 = that._y2 = null;\r\n        return that\r\n    },\r\n    _locateElements: function(locationOptions) {\r\n        this._moveInInitialValues();\r\n        this._locateRowsColumns(locationOptions)\r\n    },\r\n    _moveInInitialValues: function() {\r\n        var that = this;\r\n        that._title.hasText() && that._title.move([0, 0]);\r\n        that._legendGroup && that._legendGroup.move(0, 0);\r\n        that._background && that._background.attr({\r\n            x: 0,\r\n            y: 0,\r\n            width: 0,\r\n            height: 0\r\n        })\r\n    },\r\n    applySelected: function(id) {\r\n        applyMarkerState(id, this._markersId, this._items, \"selection\");\r\n        return this\r\n    },\r\n    applyHover: function(id) {\r\n        applyMarkerState(id, this._markersId, this._items, \"hover\");\r\n        return this\r\n    },\r\n    resetItem: function(id) {\r\n        applyMarkerState(id, this._markersId, this._items, \"normal\");\r\n        return this\r\n    },\r\n    _createLabel: function(data, group) {\r\n        var labelFormatObject = this._getCustomizeObject(data);\r\n        var options = this._options;\r\n        var align = getAlign(options.itemTextPosition);\r\n        var text = options.customizeText.call(labelFormatObject, labelFormatObject);\r\n        var fontStyle = _isDefined(data.textOpacity) ? {\r\n            color: options.font.color,\r\n            opacity: data.textOpacity\r\n        } : {};\r\n        return this._renderer.text(text, 0, 0).css((0, _utils.patchFontOptions)(fontStyle)).attr({\r\n            align: align,\r\n            \"class\": options.cssClass\r\n        }).append(group)\r\n    },\r\n    _createHint: function(data, group) {\r\n        var labelFormatObject = this._getCustomizeObject(data);\r\n        var text = this._options.customizeHint.call(labelFormatObject, labelFormatObject);\r\n        if (_isDefined(text) && \"\" !== text) {\r\n            group.setTitle(text)\r\n        }\r\n    },\r\n    _createBackground: function() {\r\n        var that = this;\r\n        var isInside = that._options.position === INSIDE;\r\n        var color = that._options.backgroundColor;\r\n        var fill = color || (isInside ? that._options.containerBackgroundColor : NONE);\r\n        if (that._options.border.visible || (isInside || color) && color !== NONE) {\r\n            that._background = that._renderer.rect(0, 0, 0, 0).attr({\r\n                fill: fill,\r\n                \"class\": that._backgroundClass\r\n            }).append(that._insideLegendGroup)\r\n        }\r\n    },\r\n    _locateRowsColumns: function(options) {\r\n        var that = this;\r\n        var iteration = 0;\r\n        var layoutOptions = that._getItemsLayoutOptions();\r\n        var countItems = that._items.length;\r\n        var lines;\r\n        do {\r\n            lines = [];\r\n            that._createLines(lines, layoutOptions);\r\n            that._alignLines(lines, layoutOptions);\r\n            iteration++\r\n        } while (checkLinesSize(lines, layoutOptions, countItems, options.margin) && iteration < countItems);\r\n        that._applyItemPosition(lines, layoutOptions)\r\n    },\r\n    _createLines: function(lines, layoutOptions) {\r\n        this._items.forEach(function(item, i) {\r\n            var tableLine = getLines(lines, layoutOptions, i);\r\n            var labelBox = {\r\n                width: item.labelBBox.width,\r\n                height: item.labelBBox.height,\r\n                element: item.label,\r\n                bBox: item.labelBBox,\r\n                pos: getPos(layoutOptions),\r\n                itemIndex: i\r\n            };\r\n            var markerBox = {\r\n                width: item.markerBBox.width,\r\n                height: item.markerBBox.height,\r\n                element: item.marker,\r\n                pos: {\r\n                    horizontal: CENTER,\r\n                    vertical: CENTER\r\n                },\r\n                bBox: {\r\n                    width: item.markerBBox.width,\r\n                    height: item.markerBBox.height,\r\n                    x: item.markerBBox.x,\r\n                    y: item.markerBBox.y\r\n                },\r\n                itemIndex: i\r\n            };\r\n            var firstItem;\r\n            var secondItem;\r\n            var offsetDirection = layoutOptions.markerOffset ? \"altOffset\" : \"offset\";\r\n            if (layoutOptions.inverseLabelPosition) {\r\n                firstItem = labelBox;\r\n                secondItem = markerBox\r\n            } else {\r\n                firstItem = markerBox;\r\n                secondItem = labelBox\r\n            }\r\n            firstItem[offsetDirection] = layoutOptions.labelOffset;\r\n            tableLine.secondLine.push(firstItem);\r\n            tableLine.firstLine.push(secondItem)\r\n        })\r\n    },\r\n    _alignLines: function(lines, layoutOptions) {\r\n        var i;\r\n        var measure = layoutOptions.altMeasure;\r\n        lines.forEach(function(line) {\r\n            return setMaxInLine(line, measure)\r\n        });\r\n        measure = layoutOptions.measure;\r\n        if (layoutOptions.itemsAlignment) {\r\n            if (layoutOptions.markerOffset) {\r\n                for (i = 0; i < lines.length;) {\r\n                    transpose([lines[i++], lines[i++]]).forEach(processLine)\r\n                }\r\n            }\r\n        } else {\r\n            transpose(lines).forEach(processLine)\r\n        }\r\n\r\n        function processLine(line) {\r\n            setMaxInLine(line, measure)\r\n        }\r\n    },\r\n    _applyItemPosition: function(lines, layoutOptions) {\r\n        var that = this;\r\n        var position = {\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        var maxLineLength = getMaxLineLength(lines, layoutOptions);\r\n        lines.forEach(function(line) {\r\n            var firstItem = line[0];\r\n            var altOffset = firstItem.altOffset || layoutOptions.altSpacing;\r\n            position[layoutOptions.direction] = getInitPositionForDirection(line, layoutOptions, maxLineLength);\r\n            line.forEach(function(item) {\r\n                var offset = item.offset || layoutOptions.spacing;\r\n                var wrap = new _layout_element.WrapperLayoutElement(item.element, item.bBox);\r\n                var itemBBoxOptions = {\r\n                    x: position.x,\r\n                    y: position.y,\r\n                    width: item.width,\r\n                    height: item.height\r\n                };\r\n                var itemBBox = new _layout_element.WrapperLayoutElement(null, itemBBoxOptions);\r\n                var itemLegend = that._items[item.itemIndex];\r\n                wrap.position({\r\n                    of: itemBBox,\r\n                    my: item.pos,\r\n                    at: item.pos\r\n                });\r\n                itemLegend.bBoxes.push(itemBBox);\r\n                position[layoutOptions.direction] += item[layoutOptions.measure] + offset\r\n            });\r\n            position[layoutOptions.altDirection] += firstItem[layoutOptions.altMeasure] + altOffset\r\n        });\r\n        this._items.forEach(function(item) {\r\n            var itemBBox = calculateBBoxLabelAndMarker(item.bBoxes[0].getLayoutOptions(), item.bBoxes[1].getLayoutOptions());\r\n            var horizontal = that._options.columnItemSpacing / 2;\r\n            var vertical = that._options.rowItemSpacing / 2;\r\n            item.tracker.left = itemBBox.left - horizontal;\r\n            item.tracker.right = itemBBox.right + horizontal;\r\n            item.tracker.top = itemBBox.top - vertical;\r\n            item.tracker.bottom = itemBBox.bottom + vertical\r\n        })\r\n    },\r\n    _getItemsLayoutOptions: function() {\r\n        var that = this;\r\n        var options = that._options;\r\n        var orientation = options.orientation;\r\n        var layoutOptions = {\r\n            itemsAlignment: options.itemsAlignment,\r\n            orientation: options.orientation\r\n        };\r\n        var width = that._size.width - (that._background ? 2 * options.paddingLeftRight : 0);\r\n        var height = that._size.height - (that._background ? 2 * options.paddingTopBottom : 0);\r\n        if (orientation === HORIZONTAL) {\r\n            layoutOptions.length = width;\r\n            layoutOptions.spacing = options.columnItemSpacing;\r\n            layoutOptions.direction = \"x\";\r\n            layoutOptions.measure = WIDTH;\r\n            layoutOptions.altMeasure = HEIGHT;\r\n            layoutOptions.altDirection = \"y\";\r\n            layoutOptions.altSpacing = options.rowItemSpacing;\r\n            layoutOptions.countItem = options.columnCount;\r\n            layoutOptions.altCountItem = options.rowCount;\r\n            layoutOptions.marginTextLabel = 4;\r\n            layoutOptions.labelOffset = 7;\r\n            if (options.itemTextPosition === BOTTOM || options.itemTextPosition === TOP) {\r\n                layoutOptions.labelOffset = 4;\r\n                layoutOptions.markerOffset = true\r\n            }\r\n        } else {\r\n            layoutOptions.length = height;\r\n            layoutOptions.spacing = options.rowItemSpacing;\r\n            layoutOptions.direction = \"y\";\r\n            layoutOptions.measure = HEIGHT;\r\n            layoutOptions.altMeasure = WIDTH;\r\n            layoutOptions.altDirection = \"x\";\r\n            layoutOptions.altSpacing = options.columnItemSpacing;\r\n            layoutOptions.countItem = options.rowCount;\r\n            layoutOptions.altCountItem = options.columnCount;\r\n            layoutOptions.marginTextLabel = 7;\r\n            layoutOptions.labelOffset = 4;\r\n            if (options.itemTextPosition === RIGHT || options.itemTextPosition === LEFT) {\r\n                layoutOptions.labelOffset = 7;\r\n                layoutOptions.markerOffset = true\r\n            }\r\n        }\r\n        if (!layoutOptions.countItem) {\r\n            if (layoutOptions.altCountItem) {\r\n                layoutOptions.countItem = _ceil(that._items.length / layoutOptions.altCountItem)\r\n            } else {\r\n                layoutOptions.countItem = that._items.length\r\n            }\r\n        }\r\n        if (options.itemTextPosition === TOP || options.itemTextPosition === LEFT) {\r\n            layoutOptions.inverseLabelPosition = true\r\n        }\r\n        layoutOptions.itemTextPosition = options.itemTextPosition;\r\n        layoutOptions.altCountItem = layoutOptions.altCountItem || _ceil(that._items.length / layoutOptions.countItem);\r\n        return layoutOptions\r\n    },\r\n    _adjustBackgroundSettings: function(locationOptions) {\r\n        if (!this._background) {\r\n            return\r\n        }\r\n        var border = locationOptions.border;\r\n        var legendBox = this._calculateTotalBox();\r\n        var backgroundSettings = {\r\n            x: _round(legendBox.x - locationOptions.paddingLeftRight),\r\n            y: _round(legendBox.y - locationOptions.paddingTopBottom),\r\n            width: _round(legendBox.width) + 2 * locationOptions.paddingLeftRight,\r\n            height: _round(legendBox.height),\r\n            opacity: locationOptions.backgroundOpacity\r\n        };\r\n        if (border.visible && border.width && border.color && border.color !== NONE) {\r\n            backgroundSettings[\"stroke-width\"] = border.width;\r\n            backgroundSettings.stroke = border.color;\r\n            backgroundSettings[\"stroke-opacity\"] = border.opacity;\r\n            backgroundSettings.dashStyle = border.dashStyle;\r\n            backgroundSettings.rx = border.cornerRadius || 0;\r\n            backgroundSettings.ry = border.cornerRadius || 0\r\n        }\r\n        this._background.attr(backgroundSettings)\r\n    },\r\n    _setBoundingRect: function(margin) {\r\n        if (!this._insideLegendGroup) {\r\n            return\r\n        }\r\n        var box = this._calculateTotalBox();\r\n        box.height += margin.top + margin.bottom;\r\n        box.widthWithoutMargins = box.width;\r\n        box.width += margin.left + margin.right;\r\n        box.x -= margin.left;\r\n        box.y -= margin.top;\r\n        this._boundingRect = box\r\n    },\r\n    _calculateTotalBox: function() {\r\n        var markerBox = this._markersGroup.getBBox();\r\n        var titleBox = this._title.getCorrectedLayoutOptions();\r\n        var box = this._insideLegendGroup.getBBox();\r\n        var verticalPadding = this._background ? 2 * this._options.paddingTopBottom : 0;\r\n        box.height = markerBox.height + titleBox.height + verticalPadding;\r\n        titleBox.width > box.width && (box.width = titleBox.width);\r\n        return box\r\n    },\r\n    getActionCallback: function(point) {\r\n        var that = this;\r\n        if (that._options.visible) {\r\n            return function(act) {\r\n                that[act](point.index)\r\n            }\r\n        } else {\r\n            return _common.noop\r\n        }\r\n    },\r\n    getLayoutOptions: function() {\r\n        var options = this._options;\r\n        var boundingRect = this._insideLegendGroup ? this._boundingRect : {\r\n            width: 0,\r\n            height: 0,\r\n            x: 0,\r\n            y: 0\r\n        };\r\n        if (options) {\r\n            boundingRect.verticalAlignment = options.verticalAlignment;\r\n            boundingRect.horizontalAlignment = options.horizontalAlignment;\r\n            if (options.orientation === HORIZONTAL) {\r\n                boundingRect.cutLayoutSide = options.verticalAlignment;\r\n                boundingRect.cutSide = \"vertical\"\r\n            } else {\r\n                if (options.horizontalAlignment === CENTER) {\r\n                    boundingRect.cutLayoutSide = options.verticalAlignment;\r\n                    boundingRect.cutSide = \"vertical\"\r\n                } else {\r\n                    boundingRect.cutLayoutSide = options.horizontalAlignment;\r\n                    boundingRect.cutSide = \"horizontal\"\r\n                }\r\n            }\r\n            boundingRect.position = {\r\n                horizontal: options.horizontalAlignment,\r\n                vertical: options.verticalAlignment\r\n            };\r\n            return boundingRect\r\n        }\r\n        return null\r\n    },\r\n    shift: function(x, y) {\r\n        var that = this;\r\n        var box = {};\r\n        if (that._insideLegendGroup) {\r\n            that._insideLegendGroup.attr({\r\n                translateX: x - that._boundingRect.x,\r\n                translateY: y - that._boundingRect.y\r\n            })\r\n        }\r\n        that._title && that._shiftTitle(that._boundingRect.widthWithoutMargins);\r\n        that._markersGroup && that._shiftMarkers();\r\n        if (that._insideLegendGroup) {\r\n            box = that._legendGroup.getBBox()\r\n        }\r\n        that._x1 = box.x;\r\n        that._y1 = box.y;\r\n        that._x2 = box.x + box.width;\r\n        that._y2 = box.y + box.height;\r\n        return that\r\n    },\r\n    _shiftTitle: function(boxWidth) {\r\n        var that = this;\r\n        var title = that._title;\r\n        var titleBox = title.getCorrectedLayoutOptions();\r\n        if (!titleBox || !title.hasText()) {\r\n            return\r\n        }\r\n        var width = boxWidth - (that._background ? 2 * that._options.paddingLeftRight : 0);\r\n        var titleOptions = title.getOptions();\r\n        var titleY = titleBox.y + titleOptions.margin.top;\r\n        var titleX = 0;\r\n        if (titleOptions.verticalAlignment === BOTTOM && that._markersGroup) {\r\n            titleY += that._markersGroup.getBBox().height\r\n        }\r\n        if (titleOptions.horizontalAlignment === RIGHT) {\r\n            titleX = width - titleBox.width\r\n        } else {\r\n            if (titleOptions.horizontalAlignment === CENTER) {\r\n                titleX = (width - titleBox.width) / 2\r\n            }\r\n        }\r\n        title.shift(titleX, titleY)\r\n    },\r\n    _shiftMarkers: function() {\r\n        var titleBox = this._title.getLayoutOptions();\r\n        var markerBox = this._markersGroup.getBBox();\r\n        var titleOptions = this._title.getOptions() || {};\r\n        var center = 0;\r\n        var y = 0;\r\n        if (titleBox.width > markerBox.width && this._options.horizontalAlignment === CENTER) {\r\n            center = titleBox.width / 2 - markerBox.width / 2\r\n        }\r\n        if (titleOptions.verticalAlignment === TOP) {\r\n            y = titleBox.height\r\n        }\r\n        if (0 !== center || 0 !== y) {\r\n            this._markersGroup.attr({\r\n                translateX: center,\r\n                translateY: y\r\n            });\r\n            this._items.forEach(function(item) {\r\n                item.tracker.left += center;\r\n                item.tracker.right += center;\r\n                item.tracker.top += y;\r\n                item.tracker.bottom += y\r\n            })\r\n        }\r\n    },\r\n    getPosition: function() {\r\n        return this._options.position\r\n    },\r\n    coordsIn: function(x, y) {\r\n        return x >= this._x1 && x <= this._x2 && y >= this._y1 && y <= this._y2\r\n    },\r\n    getItemByCoord: function(x, y) {\r\n        var items = this._items;\r\n        var legendGroup = this._insideLegendGroup;\r\n        x -= legendGroup.attr(\"translateX\");\r\n        y -= legendGroup.attr(\"translateY\");\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (inRect(items[i].tracker, x, y)) {\r\n                return items[i].tracker\r\n            }\r\n        }\r\n        return null\r\n    },\r\n    dispose: function() {\r\n        var that = this;\r\n        that._title && that._title.dispose();\r\n        that._legendGroup = that._insideLegendGroup = that._title = that._renderer = that._options = that._data = that._items = null;\r\n        return that\r\n    },\r\n    layoutOptions: function() {\r\n        if (!this.isVisible()) {\r\n            return null\r\n        }\r\n        var pos = this.getLayoutOptions();\r\n        return {\r\n            horizontalAlignment: this._options.horizontalAlignment,\r\n            verticalAlignment: this._options.verticalAlignment,\r\n            side: pos.cutSide,\r\n            priority: 1,\r\n            position: this.getPosition()\r\n        }\r\n    },\r\n    measure: function(size) {\r\n        if (this._updated || !this._insideLegendGroup) {\r\n            this.draw(size[0], size[1]);\r\n            this._updated = false\r\n        } else {\r\n            this._items.forEach(function(item) {\r\n                item.bBoxes = []\r\n            });\r\n            this._updateElementsPosition(size[0], size[1])\r\n        }\r\n        var rect = this.getLayoutOptions();\r\n        return [rect.width, rect.height]\r\n    },\r\n    move: function(rect) {\r\n        this.shift(rect[0], rect[1])\r\n    },\r\n    freeSpace: function() {\r\n        this._options._incidentOccurred(\"W2104\");\r\n        this.erase()\r\n    }\r\n});\r\nvar plugin = {\r\n    name: \"legend\",\r\n    init: function() {\r\n        var that = this;\r\n        var group = this._renderer.g().attr({\r\n            \"class\": this._rootClassPrefix + \"-legend\"\r\n        }).enableLinks().append(that._renderer.root);\r\n        that._legend = new Legend({\r\n            renderer: that._renderer,\r\n            group: group,\r\n            widget: this,\r\n            itemGroupClass: this._rootClassPrefix + \"-item\",\r\n            titleGroupClass: this._rootClassPrefix + \"-title\",\r\n            textField: \"text\",\r\n            getFormatObject: function(data) {\r\n                return {\r\n                    item: data.item,\r\n                    text: data.text\r\n                }\r\n            }\r\n        });\r\n        that._layout.add(that._legend)\r\n    },\r\n    extenders: {\r\n        _applyTilesAppearance: function() {\r\n            var that = this;\r\n            this._items.forEach(function(item) {\r\n                that._applyLegendItemStyle(item.id, item.getState())\r\n            })\r\n        },\r\n        _buildNodes: function() {\r\n            this._createLegendItems()\r\n        }\r\n    },\r\n    members: {\r\n        _applyLegendItemStyle: function(id, state) {\r\n            var legend = this._legend;\r\n            switch (state) {\r\n                case \"hover\":\r\n                    legend.applyHover(id);\r\n                    break;\r\n                case \"selection\":\r\n                    legend.applySelected(id);\r\n                    break;\r\n                default:\r\n                    legend.resetItem(id)\r\n            }\r\n        },\r\n        _createLegendItems: function() {\r\n            if (this._legend.update(this._getLegendData(), this._getOption(\"legend\"), this._themeManager.theme(\"legend\").title)) {\r\n                this._requestChange([\"LAYOUT\"])\r\n            }\r\n        }\r\n    },\r\n    dispose: function() {\r\n        this._legend.dispose()\r\n    },\r\n    customize: function(constructor) {\r\n        constructor.prototype._proxyData.push(function(x, y) {\r\n            if (this._legend.coordsIn(x, y)) {\r\n                var item = this._legend.getItemByCoord(x, y);\r\n                if (item) {\r\n                    return {\r\n                        id: item.id,\r\n                        type: \"legend\"\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        constructor.addChange({\r\n            code: \"LEGEND\",\r\n            handler: function() {\r\n                this._createLegendItems()\r\n            },\r\n            isThemeDependent: true,\r\n            option: \"legend\",\r\n            isOptionChange: true\r\n        })\r\n    }\r\n};\r\nexports.plugin = plugin;\r\n"]},"metadata":{},"sourceType":"script"}